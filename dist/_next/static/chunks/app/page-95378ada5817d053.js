(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{414:(e,t,r)=>{"use strict";function a(e){return e&&"object"==typeof e?e.Product_ID&&"number"==typeof e.Product_ID?{...e,Product_Name:e.Product_Name||"Неизвестный товар",images:Array.isArray(e.images)?e.images:[],categories:Array.isArray(e.categories)?e.categories:[],marks:Array.isArray(e.marks)?e.marks:[],parameters:Array.isArray(e.parameters)?e.parameters:[],colors:Array.isArray(e.colors)?e.colors.map(t=>({Color_ID:(null==t?void 0:t.Color_ID)||0,Color_Name:(null==t?void 0:t.Color_Name)||"",Color_Code:(null==t?void 0:t.Color_Code)||"",Color_image:(null==t?void 0:t.Color_image)||null,Product_ID:(null==t?void 0:t.Product_ID)||e.Product_ID||0,discount:(null==t?void 0:t.discount)||null})):[],extras:Array.isArray(e.extras)?e.extras:[],reviews:Array.isArray(e.reviews)?e.reviews:[],reviews_video:Array.isArray(e.reviews_video)?e.reviews_video:[]}:(console.error("Продукт без валидного ID:",e),null):(console.error("Невалидные данные продукта:",e),null)}r.d(t,{OJ:()=>s});let s={categories:[],product_marks:[],overall_product_tags_by_category:{},products:[]}},601:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>eo});var a=r(5155),s=r(2115),o=r(925);r(7576);var l=r(5695);let n="https://static-sda.ru/front_end/icons/";var i=r(9543),c=r(3464);let d=c.A.create({baseURL:"".concat(window.location.origin,"/api")});d.interceptors.request.use(e=>e,e=>{console.debug(e)}),d.interceptors.response.use(e=>e,async e=>{var t;let r=e.config;(null==(t=e.response)?void 0:t.status)!==401||r._retry||(r._retry=!0),console.debug(e)});var p=r(2471);class m{setupAutoRefresh(e){this.refreshInterval&&clearInterval(this.refreshInterval),this.refreshInterval=window.setInterval(()=>{this.fetchProducts()},e)}async refreshData(){return this.fetchProducts()}async fetchProducts(){this.error=null;try{let e=await d.get("/products");return(0,i.h5)(()=>{this.data=e.data,this.lastUpdated=Date.now(),console.log(e.data),window.dispatchEvent(new Event("storeDataUpdated"))}),console.log("Данные обновлены из API:",this.lastUpdated),!0}catch(e){return(0,i.h5)(()=>{this.error=e instanceof Error?e.message:"Неизвестная ошибка"}),console.error("Ошибка при обновлении данных:",this.error),!1}}constructor(){this.data={},this.error=null,this.lastUpdated=0,this.refreshInterval=null,(0,i.l_)(this),(0,p.pu)(this,{name:"DataStore",properties:["data","lastUpdated"],storage:window.localStorage}),this.fetchProducts(),this.setupAutoRefresh(3e5)}}let u=new m;r(8548);let g=()=>{let e=window.navigator.userAgent.toLowerCase();return/iphone|ipad|ipod/.test(e)},h=()=>{(0,l.usePathname)();let e=(0,o.zy)(),[t,r]=(0,s.useState)({}),[i,c]=(0,s.useState)(null),d=(0,s.useRef)(null),p=(0,s.useRef)(null);function m(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)}return(0,s.useRef)(null),(0,s.useEffect)(()=>{let t=window.Telegram.WebApp;return console.log("Version 0.0.32452"),console.log(e.pathname),t?(c(t),t.expand(),t.ready(),t.version>="7.9"&&(m()&&t.requestFullscreen(),t.disableVerticalSwipes(),t.setHeaderColor("#f1f1f1"),t.setBottomBarColor("#f1f1f1"),t.setBackgroundColor("#f1f1f1"),"/"===e.pathname?t.BackButton.hide():(t.BackButton.show(),t.BackButton.onClick(()=>{window.history.back()}))),t.initDataUnsafe&&t.initDataUnsafe.user&&r(t.initDataUnsafe.user),window.addEventListener("pageshow",e=>{e.persisted&&window.location.reload()})):console.warn("Telegram WebApp не доступен. Запуск вне Mini App."),()=>{window.removeEventListener("pageshow",()=>{})}},[e]),(0,a.jsxs)("header",{className:"header \n    ".concat(!m()?"header-mobile":"","\n    ").concat(g()?"header-ios":""),children:[(0,a.jsxs)("div",{className:"header-profile",children:[(0,a.jsx)("img",{ref:d,className:"header-profile-image",src:t.photo_url,alt:"",id:"header-avatar-image"}),(0,a.jsxs)("p",{ref:p,className:"header-profile-text",id:"header-username-text",children:[t.first_name?(e=>e?e.charAt(0).toLocaleUpperCase()+e.slice(1).toLocaleLowerCase():"")(t.first_name):"Вы"," ",t.last_name||""]})]}),(0,a.jsxs)("button",{onClick:function(){var e,t;let r=(null==(t=u.data)||null==(e=t.special_project_parameters)?void 0:e.telegram_header_link_value)||"noxerai_bot";r.startsWith("@")&&(r=r.substring(1));let a="https://t.me/".concat(r);a&&window.open(a,"_blank")},className:"header-telegram",children:[(0,a.jsx)("img",{src:"".concat(n,"telegram-icon.svg"),alt:""}),(0,a.jsx)("p",{className:"header-telegram-text index-telegram-open-special_tg",children:(()=>{var e,t;return(null==(t=u.data)||null==(e=t.special_project_parameters)?void 0:e.project_name_value)||"noxerai_bot"})()})]})]})};var x=r(3438);class v{addToCart(e,t){let r="object"==typeof t&&null!==t,a=r?t.paramTitle:t,s=r?t.colorId:null,o=r?t.colorImage:null;console.log("Добавление в корзину:",{id:e,paramTitle:a,colorId:s,colorImage:o});let l=this.items.find(t=>{var r,o,l;let n=t.Product_ID===e&&(!a||(null==(r=t.parameters)?void 0:r.parameter_string)===a),i=!s||(null==(o=t.selectedColor)?void 0:o.id)===s;return console.log("Проверка существующего товара: ".concat(t.Product_ID),{paramMatch:n,colorMatch:i,existingColorId:null==(l=t.selectedColor)?void 0:l.id,newColorId:s}),n&&i});if(l){console.log("Товар уже в корзине, увеличиваем количество"),this.increaseQuantity(l.Product_ID,a,s);return}if(!u.data||!u.data.products)return void console.error("Данные о продуктах не загружены из dataStore.");let n=u.data.products.find(t=>t.Product_ID===e);if(!n)return void console.error("Продукт с ID ".concat(e," не найден в dataStore."));let c=null;a&&n.parameters&&Array.isArray(n.parameters)&&((c=n.parameters.find(e=>e.parameter_string===a))||!(n.parameters.length>0)||(c=n.parameters[0]));let d=null;s&&n.colors&&Array.isArray(n.colors)&&((d=n.colors.find(e=>e.Color_ID===s))||!r||!t.colorName||(d={Color_ID:s,Color_Name:t.colorName,Color_Code:t.colorCode||"",Color_image:o,Product_ID:e,discount:t.discount||0}));let p=(null==c?void 0:c.price)||n.Price||0;d&&d.discount&&(p=Math.max(0,p-d.discount));let m={...n,parameters:c,selectedColor:d?{id:d.Color_ID,name:d.Color_Name,code:d.Color_Code,image:d.Color_image||o,discount:d.discount}:null,final_price:p,quantity:1};console.log("Добавлен новый товар в корзину:",m),(0,i.h5)(()=>{this.items=[...this.items,m]})}removeFromCart(e,t,r){(0,i.h5)(()=>{this.items=this.items.filter(a=>{var s,o;let l=!(a.Product_ID===e&&(!t||(null==(s=a.parameters)?void 0:s.parameter_string)===t)),n=!r||(null==(o=a.selectedColor)?void 0:o.id)!==r;return l||n})})}clearCart(){console.log("Очистка корзины"),(0,i.h5)(()=>{this.items=[]}),localStorage.removeItem("addedSettingItems"),console.log("Локальное хранилище очищено")}increaseQuantity(e,t,r){let a=[...this.items],s=a.findIndex(a=>{var s,o;let l=a.Product_ID===e&&(!t||(null==(s=a.parameters)?void 0:s.parameter_string)===t),n=!r||(null==(o=a.selectedColor)?void 0:o.id)===r;return l&&n});-1!==s&&(a[s]={...a[s],quantity:(a[s].quantity||1)+1},(0,i.h5)(()=>{this.items=a}))}decreaseQuantity(e,t,r){let a=[...this.items],s=a.findIndex(a=>{var s,o;let l=a.Product_ID===e&&(!t||(null==(s=a.parameters)?void 0:s.parameter_string)===t),n=!r||(null==(o=a.selectedColor)?void 0:o.id)===r;return l&&n});-1!==s&&a[s].quantity>1&&(a[s]={...a[s],quantity:a[s].quantity-1},(0,i.h5)(()=>{this.items=a}))}constructor(){this.items=[],(0,i.l_)(this),(0,p.pu)(this,{name:"ShoppingCartStore",properties:["items"],storage:window.localStorage})}}let f=new v;r(8358);let j=(0,x.PA)(()=>{let e=(0,o.zy)(),[t,r]=(0,s.useState)(!1),[l,n]=(0,s.useState)([{id:1,icon:'<svg width="21" height="21" viewBox="0 0 21 21" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path d="M7.34655 18.9553H3.98376C2.74494 18.9553 1.74121 17.9516 1.74121 16.7127V10.1159C1.74197 9.63537 1.84541 9.1605 2.0446 8.72315C2.2438 8.2858 2.53415 7.89606 2.89621 7.58005L8.95742 2.30077C9.36557 1.94571 9.88831 1.75015 10.4293 1.75015C10.9703 1.75015 11.493 1.94571 11.9011 2.30077L17.9624 7.58107C18.3243 7.89697 18.6146 8.28654 18.8138 8.72371C19.0129 9.16087 19.1165 9.63554 19.1174 10.1159V16.7127C19.1174 17.3073 18.8812 17.8776 18.4609 18.2981C18.0406 18.7186 17.4704 18.955 16.8758 18.9553H13.7921V12.2287C13.7921 11.3006 13.0398 10.5473 12.1107 10.5473H9.02897C8.09986 10.5473 7.34757 11.3006 7.34757 12.2287L7.34655 18.9553ZM7.34655 18.9553H13.7931" stroke="#8B8B8B" strokeWidth="1.3" strokeLinejoin="round"/>\n</svg>',href:"/",isActive:!1},{id:2,icon:'<svg width="21" height="21" viewBox="0 0 21 21" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path d="M4.375 8.75H6.125C7.875 8.75 8.75 7.875 8.75 6.125V4.375C8.75 2.625 7.875 1.75 6.125 1.75H4.375C2.625 1.75 1.75 2.625 1.75 4.375V6.125C1.75 7.875 2.625 8.75 4.375 8.75Z" stroke="#8B8B8B" strokeWidth="1.3" strokeMiterlimit="10" strokeLinecap="round" strokeLinejoin="round"/>\n<path d="M14.875 8.75H16.625C18.375 8.75 19.25 7.875 19.25 6.125V4.375C19.25 2.625 18.375 1.75 16.625 1.75H14.875C13.125 1.75 12.25 2.625 12.25 4.375V6.125C12.25 7.875 13.125 8.75 14.875 8.75Z" stroke="#8B8B8B" strokeWidth="1.3" strokeMiterlimit="10" strokeLinecap="round" strokeLinejoin="round"/>\n<path d="M14.875 19.25H16.625C18.375 19.25 19.25 18.375 19.25 16.625V14.875C19.25 13.125 18.375 12.25 16.625 12.25H14.875C13.125 12.25 12.25 13.125 12.25 14.875V16.625C12.25 18.375 13.125 19.25 14.875 19.25Z" stroke="#8B8B8B" strokeWidth="1.3" strokeMiterlimit="10" strokeLinecap="round" strokeLinejoin="round"/>\n<path d="M4.375 19.25H6.125C7.875 19.25 8.75 18.375 8.75 16.625V14.875C8.75 13.125 7.875 12.25 6.125 12.25H4.375C2.625 12.25 1.75 13.125 1.75 14.875V16.625C1.75 18.375 2.625 19.25 4.375 19.25Z" stroke="#8B8B8B" strokeWidth="1.3" strokeMiterlimit="10" strokeLinecap="round" strokeLinejoin="round"/>\n</svg>',href:"/catalog",isActive:!1},{id:4,icon:'<svg width="21" height="21" viewBox="0 0 21 21" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path d="M11.0425 18.2088C10.745 18.3138 10.255 18.3138 9.9575 18.2088C7.42 17.3426 1.75 13.7288 1.75 7.60384C1.75 4.90009 3.92875 2.71259 6.615 2.71259C8.2075 2.71259 9.61625 3.48259 10.5 4.67259C11.3837 3.48259 12.8013 2.71259 14.385 2.71259C17.0713 2.71259 19.25 4.90009 19.25 7.60384C19.25 13.7288 13.58 17.3426 11.0425 18.2088Z" stroke="#8B8B8B" strokeWidth="1.3" strokeLinecap="round" strokeLinejoin="round"/>\n</svg>',href:"/favorites",isActive:!1},{id:5,icon:'<svg width="21" height="21" viewBox="0 0 21 21" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path d="M7.70913 1.75L4.54163 4.92625" stroke="#8B8B8B" strokeWidth="1.3" strokeMiterlimit="10" strokeLinecap="round" strokeLinejoin="round"/>\n<path d="M13.2916 1.75L16.4591 4.92625" stroke="#8B8B8B" strokeWidth="1.3" strokeMiterlimit="10" strokeLinecap="round" strokeLinejoin="round"/>\n<path d="M1.75 6.86816C1.75 5.24941 2.61625 5.11816 3.6925 5.11816H17.3075C18.3838 5.11816 19.25 5.24941 19.25 6.86816C19.25 8.74941 18.3838 8.61816 17.3075 8.61816H3.6925C2.61625 8.61816 1.75 8.74941 1.75 6.86816Z" stroke="#8B8B8B" strokeWidth="1.3"/>\n<path d="M8.54004 12.25V15.3562" stroke="#8B8B8B" strokeWidth="1.3" strokeLinecap="round"/>\n<path d="M12.5653 12.25V15.3562" stroke="#8B8B8B" strokeWidth="1.3" strokeLinecap="round"/>\n<path d="M3.0625 8.75L4.29625 16.31C4.57625 18.0075 5.25 19.25 7.7525 19.25H13.0288C15.75 19.25 16.1525 18.06 16.4675 16.415L17.9375 8.75" stroke="#8B8B8B" strokeWidth="1.3" strokeLinecap="round"/>\n</svg>',href:"/shoppingcart",isActive:!1}]),i=(0,s.useMemo)(()=>[...f.items].reduce((e,t)=>e+(t.quantity||1),0),[f.items]);return(0,s.useEffect)(()=>{console.log("TheFooter: Cart items:",f.items.length,"Cart count:",i)},[i]),(0,s.useEffect)(()=>{console.log("TheFooter: Current location:",e.pathname),n(l.map(t=>t.href===e.pathname?{...t,isActive:!0}:{...t,isActive:!1}))},[e]),(0,s.useEffect)(()=>{r(g())},[]),(0,a.jsx)("footer",{className:"footer ".concat(t?"footer-ios":""),children:(0,a.jsxs)("nav",{className:"footer-nav",children:[l.map(e=>(0,a.jsx)(o.k2,{to:e.href,className:"footer-nav-link click-effect-block ".concat(e.isActive?"activeLink":""),dangerouslySetInnerHTML:{__html:e.icon}},e.id)),i>0&&(0,a.jsx)("span",{className:"footer-cart-badge".concat(e.pathname.includes("shoppingcart")?" footer-cart-badge--active":""),children:i})]})})}),_=e=>{let{children:t}=e,r=(0,o.zy)().pathname.includes("/product/");return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(h,{}),t,(0,a.jsx)("div",{className:"wrapper-footer \n          ".concat(r?"wrapper-footer-productPage":"","\n          ").concat(g()?"wrapper-footer--ios":"","\n          "),children:(0,a.jsxs)("p",{className:"footer-text",children:["Разработано на платформе Noxer ",(0,a.jsx)("br",{}),(0,a.jsxs)("a",{href:"#",onClick:function(){var e,t;let r=(null==(t=u.data)||null==(e=t.special_project_parameters)?void 0:e.telegram_bot_username_value)||"noxerai_bot";r.startsWith("@")&&(r=r.substring(1));let a="https://t.me/".concat(r);a&&window.open(a,"_blank")},className:"index-telegram-open-special_tg footer-link",children:["@",(()=>{var e,t;return(null==(t=u.data)||null==(e=t.special_project_parameters)?void 0:e.project_name_value)||"noxerai_bot"})()]})]})}),(0,a.jsx)(j,{})]})};var C=r(7269),N=r(7677),b=r(6874),y=r.n(b);class k{toggleFavorite(e){this.favoritesIds.includes(e)?this.favoritesIds=this.favoritesIds.filter(t=>t!==e):this.favoritesIds.push(e)}removeFavorite(e){this.favoritesIds=this.favoritesIds.filter(t=>t!==e)}isFavorite(e){return this.favoritesIds.includes(e)}constructor(){this.favoritesIds=[],(0,i.l_)(this),(0,p.pu)(this,{name:"FavoritesStore",properties:["favoritesIds"],storage:window.localStorage})}}let I=new k,w=JSON.parse('{"O5":{"q":{"_":"Подробнее"}},"ue":{"$":{"q":"Найти товары"}},"Qs":{"U$":{"D":"Каталог"}}}');r(2252),r(6970),r(9408),r(2124);let S=e=>{switch(null==e?void 0:e.toLowerCase()){case"хит":case"hit":return"bg-[#ff6723]";case"new":return"bg-[#45b649]";case"sale":return"bg-[#ffca28]";default:return"bg-[#292928]"}},T=e=>{switch(null==e?void 0:e.toLowerCase()){case"хит":case"hit":return"ХИТ";case"new":return"NEW";case"sale":return"SALE";default:return e}},A=(0,x.PA)(e=>{let{id:t,tag:r,images:s,initialPrice:l,currentPrice:n,title:i,categoryId:c}=e,d=t&&"number"==typeof t,p=r&&"string"==typeof r,m=Array.isArray(s)&&s.length>0,u=i&&"string"==typeof i;return d?(0,a.jsxs)(o.k2,{to:"/product/".concat(t),className:"product-card click-effect-block",children:[(0,a.jsxs)("div",{className:"product-card-sliderWrapper",children:[p&&""!==r.trim()&&(0,a.jsx)("div",{className:"product-card-sliderWrapper-tag ".concat(S(r)),children:T(r)}),m?(0,a.jsx)(N.RC,{modules:[C.dK],spaceBetween:10,slidesPerView:1,pagination:{clickable:!0},className:"product-card-swiper",style:{width:"100%",height:"100%"},children:s.map(e=>(0,a.jsx)(N.qr,{children:(0,a.jsx)("div",{className:"product-slide-container",children:(0,a.jsx)("img",{className:"product-card-slide-image",src:e.Image_URL?e.Image_URL:"/placeholder-image.jpg",alt:"Изображение товара ".concat(i||"Товар"),onError:e=>{e.currentTarget.src="/placeholder-image.jpg"}})})},e.Image_ID||Math.random()))}):(0,a.jsx)("div",{className:"product-card-no-image",children:(0,a.jsx)("p",{children:"Нет изображения"})}),(0,a.jsx)("button",{onClick:e=>{e.preventDefault(),e.stopPropagation(),I.toggleFavorite(t)},className:"product-card-addToFavoritesButton",children:(0,a.jsx)("svg",{width:"18",height:"16",viewBox:"0 0 18 16",fill:I.favoritesIds.some(e=>e===t)?"#FE646F":"transparent",xmlns:"http://www.w3.org/2000/svg",className:"cursor-pointer",children:(0,a.jsx)("path",{d:"M9.30663 14.7267L9.30662 14.7267L9.30029 14.7289C9.24983 14.7467 9.14099 14.7668 8.99996 14.7668C8.85893 14.7668 8.75009 14.7467 8.69963 14.7289L8.69964 14.7289L8.69329 14.7267C7.57825 14.346 5.71238 13.3333 4.13388 11.716C2.56322 10.1067 1.31663 7.94228 1.31663 5.24183C1.31663 3.02277 3.10364 1.2335 5.29996 1.2335C6.60123 1.2335 7.75317 1.86153 8.47812 2.8377C8.60075 3.00282 8.79429 3.10016 8.99996 3.10016C9.20563 3.10016 9.39917 3.00282 9.5218 2.8377C10.2464 1.86206 11.4064 1.2335 12.7 1.2335C14.8963 1.2335 16.6833 3.02277 16.6833 5.24183C16.6833 7.94228 15.4367 10.1067 13.866 11.716C12.2875 13.3333 10.4217 14.346 9.30663 14.7267Z",stroke:I.favoritesIds.some(e=>e===t)?"#FE646F":"#6C6C6C",strokeWidth:"1.3",strokeLinecap:"round",strokeLinejoin:"round"})})})]}),(0,a.jsxs)("div",{className:"product-card-priceContainer",children:[(0,a.jsx)("p",{className:"product-card-priceContainer-current product-card-text",children:n&&"string"==typeof n?"".concat(n," ₽"):"Цена по запросу"}),l&&"0"!==l&&l!==n&&(0,a.jsxs)("p",{className:"product-card-priceContainer-initial product-card-text",children:[l," ₽"]})]}),(0,a.jsx)("h4",{className:"product-card-title product-card-text",children:u?i:"Товар без названия"}),(0,a.jsx)("div",{className:"product-card-link-wrapper",children:(0,a.jsx)("p",{className:"product-card-link product-card-text",suppressHydrationWarning:!0,children:w.O5.q._||"Перейти к товару"})})]}):(console.error("Продукт без валидного ID:",t),null)});r(8720),r(4631);let E=function(){return(0,a.jsx)("div",{className:"loading-container",children:(0,a.jsx)("div",{className:"loading-spinner"})})},P=(0,x.PA)(e=>{let{isFavorites:t,categoryFilter:r,tagFilter:o,customTagFilter:n,searchQuery:i="",importanceFilter:c=!1,limit:d,showOnMainOnly:p=!1}=e,m=(0,l.usePathname)()||"",g=(0,s.useRef)(null),h=(0,s.useRef)(null),[x,v]=(0,s.useState)([]),[f,j]=(0,s.useState)([]),[_,C]=(0,s.useState)("pending"),[N,b]=(0,s.useState)(!1),[y,k]=(0,s.useState)(12),[w,S]=(0,s.useState)(!1),[T,P]=(0,s.useState)(!1),[L,D]=(0,s.useState)(!1);(0,s.useEffect)(()=>{D(!0)},[]);let M=e=>{if(!e.parameters||!Array.isArray(e.parameters)||0===e.parameters.length)return{initialPrice:"",currentPrice:"0"};let t=e.parameters.find(e=>e.chosen)||e.parameters[0];return t?{initialPrice:t.old_price?String(t.old_price):"",currentPrice:t.price?String(t.price):"0"}:{initialPrice:"",currentPrice:"0"}},O=(e,t)=>t?e.filter(e=>e.categories&&Array.isArray(e.categories)&&e.categories.length>0&&e.categories[0].Category_ID===t):e,F=(e,t)=>{if(console.log("filterCustomProducts вызван с фильтрами:",t),console.log("Всего товаров до фильтрации:",e.length),!t||0===t.length)return e;let r=e.filter(e=>{let r=t.includes("sale"),a=t.filter(e=>"sale"!==e),s=!0;r&&(s=e.marks&&Array.isArray(e.marks)&&e.marks.some(e=>e.Mark_Name&&"sale"===e.Mark_Name.toLowerCase()));let o=!0;return a.length>0&&(o=e.tags&&Array.isArray(e.tags)&&a.some(t=>e.tags.includes(t))),s&&o});return console.log("Количество товаров после фильтрации:",r.length),r},B=(e,t)=>{if(!t||""===t.trim())return e;let r=t.toLowerCase().trim().split(/\s+/).filter(e=>e.length>0);return 0===r.length?e:e.filter(e=>{if(!e.Product_Name)return!1;let t=e.Product_Name.toLowerCase(),a="";e.extras&&Array.isArray(e.extras)&&e.extras.length>0&&e.extras[0].Characteristics&&(a=e.extras[0].Characteristics.toLowerCase());let s=t+" "+a;return r.every(e=>s.includes(e))})},R=(e,t)=>{if(!t)return[...e];switch(t){case"Сначала новые":return[...e].sort((e,t)=>e.Created_At&&t.Created_At?new Date(t.Created_At).getTime()-new Date(e.Created_At).getTime():0);case"Сначала старые":return[...e].sort((e,t)=>e.Created_At&&t.Created_At?new Date(e.Created_At).getTime()-new Date(t.Created_At).getTime():0);case"Сначала дешевле":return[...e].sort((e,t)=>{let{currentPrice:r}=M(e),{currentPrice:a}=M(t);return(parseFloat(r)||0)-(parseFloat(a)||0)});case"Сначала дороже":return[...e].sort((e,t)=>{let{currentPrice:r}=M(e),{currentPrice:a}=M(t),s=parseFloat(r)||0;return(parseFloat(a)||0)-s});case"Сначала популярные":return[...e].sort((e,t)=>null!==e.importance_num&&null!==t.importance_num?t.importance_num-e.importance_num:null!==e.importance_num?-1:+(null!==t.importance_num));default:return[...e]}},W=(0,s.useCallback)(()=>t?f.filter(e=>I.favoritesIds.includes(e.Product_ID)):f,[t,f,I.favoritesIds]),H=(0,s.useCallback)(e=>p?e.filter(e=>!0===e.OnMain):e,[p]);(0,s.useEffect)(()=>{console.log("useEffect для фильтрации запущен с параметрами:"),console.log("- categoryFilter:",r),console.log("- tagFilter:",o),console.log("- customTagFilter:",n),console.log("- searchQuery:",i),console.log("- importanceFilter:",c),console.log("- showOnMainOnly:",p),console.log("Всего оригинальных товаров:",x.length);let e=[...x];p&&console.log("После фильтрации по OnMain:",(e=H(e)).length),r&&console.log("После фильтрации по категории:",(e=O(e,r)).length),o&&console.log("После сортировки по тегу:",(e=R(e,o)).length),n&&n.length>0&&(console.log("Применяем кастомный фильтр:",n),console.log("После фильтрации по кастомному тегу:",(e=F(e,n)).length)),i&&console.log("После фильтрации по поисковому запросу:",(e=B(e,i)).length),c&&console.log("После сортировки по важности:",(e=[...e].sort((e,t)=>null!==e.importance_num&&null!==t.importance_num?t.importance_num-e.importance_num:null!==e.importance_num?-1:+(null!==t.importance_num))).length),console.log("Итоговое количество товаров после всех фильтраций:",e.length),j(e)},[x,r,o,n,i,c,p]),(0,s.useEffect)(()=>{if(Object.entries(u.data).length){var e,t;b(!0),v((null==(e=u.data)?void 0:e.products)||[]),j((null==(t=u.data)?void 0:t.products)||[])}else b(!1)},[u.data]),(0,s.useEffect)(()=>{if(N){let e=W();console.log("Количество продуктов для отображения:",e.length),C(e.length>0)}},[W,N]),(0,s.useEffect)(()=>{m.includes("shoppingcart")},[m]);let U=(0,s.useCallback)(()=>{w||T||(S(!0),setTimeout(()=>{let e=W();y>=e.length||d&&y>=d?P(!0):k(t=>Math.min(t+12,d||e.length)),S(!1)},300))},[y,w,T,W,d]);return(0,s.useEffect)(()=>{if(!h.current||!L)return;let e=new IntersectionObserver(e=>{!e[0].isIntersecting||w||T||U()},{threshold:.1});return e.observe(h.current),()=>{h.current&&e.unobserve(h.current)}},[U,w,T,L]),(0,s.useEffect)(()=>{k(12),P(!1)},[r,o,n,i,p]),(0,a.jsx)("section",{className:"productsSection",ref:g,children:!1===_?(0,a.jsx)("div",{className:"no-products-message",children:"товар не найден"}):"pending"===_?(0,a.jsx)(E,{}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"productsSection-grid",children:W().slice(0,d?Math.min(y,d):y).map((e,t)=>{if(!e||!e.Product_ID)return null;let{initialPrice:r,currentPrice:s}=M(e);return(0,a.jsx)(A,{id:e.Product_ID,tag:e.marks&&Array.isArray(e.marks)&&e.marks.length>0?e.marks[0].Mark_Name:"",images:Array.isArray(e.images)?e.images:[],initialPrice:r,currentPrice:s,title:e.Product_Name||"",categoryId:e.categories&&Array.isArray(e.categories)&&e.categories.length>0?e.categories[0].Category_ID:0},"".concat(e.Product_ID,"-").concat(t))})}),!T&&!0===_&&W().length>y&&(0,a.jsx)("div",{ref:h,className:"productsSection-loader",children:w&&(0,a.jsx)(E,{})})]})})});r(8274);let L=e=>{let{children:t,height:r,between:o="10px"}=e;return(0,a.jsx)("div",{style:{height:r},className:"slider-container",children:(0,a.jsx)("div",{style:{gap:o},className:"slider-content",children:s.Children.map(t,(e,t)=>(0,a.jsx)("div",{className:"slider-item",children:e},t))})})};function D(){var e,t,r;return{categories:(null==(e=u.data)?void 0:e.categories)||[],overall_product_tags_by_category:(null==(t=u.data)?void 0:t.overall_product_tags_by_category)||{},product_marks:(null==(r=u.data)?void 0:r.product_marks)||[]}}function M(){let[e,t]=(0,s.useState)(D().categories);return(0,s.useEffect)(()=>{t(D().categories);let e=()=>{t(D().categories)};return window.addEventListener("storeDataUpdated",e),()=>{window.removeEventListener("storeDataUpdated",e)}},[]),e}D().categories,D();let O=(0,x.PA)(()=>{let[e,t]=(0,s.useState)(!1),[r,l]=(0,s.useState)("/");return(0,s.useEffect)(()=>{var e,r;t(!0);let a=null==(r=u.data)||null==(e=r.special_project_parameters)?void 0:e.reviews_link_value;a&&l(a)},[u.data]),(0,a.jsxs)("main",{"data-page":"index",className:"homeMain ".concat(g()?"homeMain--ios":""),children:[(0,a.jsx)("div",{className:"banner",children:(()=>{var t;if(!e)return(0,a.jsx)("div",{className:"banner-placeholder",style:{width:"100%",height:"150px"},children:(0,a.jsx)(E,{})});let r={modules:[C.dK],spaceBetween:10,slidesPerView:1,pagination:{clickable:!0},className:"product-card-swiper",style:{width:"100%",height:"100%"},simulateTouch:!0,touchRatio:1,resistanceRatio:0,preventInteractionOnTransition:!1};return(0,a.jsx)(N.RC,{...r,children:null==(t=u.data.special_project_parameters_actions)?void 0:t.map(e=>(0,a.jsx)(N.qr,{children:(0,a.jsx)("div",{className:"swiper-slide-content",children:(0,a.jsx)("img",{src:e.image_url?e.image_url:void 0,alt:"",className:"bannerImage"})})},e.id))})})()}),(0,a.jsxs)("div",{className:"infoCards",children:[(0,a.jsxs)(y(),{href:r,className:"reviewsCard click-effect-block",children:[(0,a.jsx)("p",{className:"reviewsTitle",children:"Отзывы"}),(0,a.jsx)("div",{className:"ratingContainer",children:(0,a.jsx)("img",{src:"".concat(n,"rating-icon.png"),alt:""})}),(0,a.jsx)("p",{className:"ratingText",children:"4,9 • 37 000 оценок"})]}),(0,a.jsxs)(o.k2,{to:"/catalog?tag=sale",className:"salesCard click-effect-block",children:[(0,a.jsx)("img",{src:"".concat(n,"sales-icon.svg"),alt:""}),(0,a.jsxs)("p",{className:"salesText",children:["Акции ",(0,a.jsx)("br",{}),"и скидки"]})]})]}),(0,a.jsx)("div",{className:"categoriesContainer",children:(0,a.jsx)(L,{height:"100%",children:M().map(e=>(0,a.jsxs)(o.k2,{to:"/catalog?category=".concat(e.Category_ID),className:"categoryItem",children:[(0,a.jsx)("img",{src:e.Category_Image?e.Category_Image:void 0,alt:""}),(0,a.jsx)("p",{className:"categoryTitle",children:2===e.Category_ID?"Аксессуары и техника":e.Category_Name})]},e.Category_ID))})}),(0,a.jsx)(P,{isFavorites:!1,importanceFilter:!0,limit:10,showOnMainOnly:!0})]})});r(7123);let F=e=>{let{activeCategory:t,onCategoryChange:r}=e,s=M();return(0,a.jsx)("div",{className:"categoryFilter",children:(0,a.jsx)(L,{height:"38px",children:s.map(e=>(0,a.jsxs)("div",{className:"categoryFilter-tag ".concat(t===e.Category_ID?"categoryFilter-tag--active":""),onClick:()=>r(e.Category_ID),children:[(0,a.jsx)("img",{src:e.Category_Image,alt:""}),(0,a.jsx)("p",{className:"categoryFilter-tag-title",children:e.Category_Name}),t===e.Category_ID&&(0,a.jsx)("button",{className:"categoryFilter-tag-closeButton",onClick:t=>{t.stopPropagation(),r(e.Category_ID)},children:(0,a.jsxs)("svg",{width:"10",height:"10",viewBox:"0 0 9 10",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,a.jsx)("path",{d:"M1 8.5L8 1.5",stroke:"#ffffff",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),(0,a.jsx)("path",{d:"M8 8.5L1 1.5",stroke:"#ffffff",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})]})})]},e.Category_ID))})})},B=[{id:5,title:"Сначала популярные"},{id:1,title:"Сначала новые"},{id:3,title:"Сначала дешевле"},{id:4,title:"Сначала дороже"}];r(1804);let R=e=>{let{activeTag:t,onTagChange:r}=e;return(0,a.jsx)("div",{className:"tagsFilter",children:(0,a.jsx)(L,{height:"38px",children:B.map(e=>(0,a.jsxs)("div",{className:"tagsFilter-tag ".concat(t===e.title?"tagsFilter-tag--active":""," ").concat("Сначала дешевле"===e.title?"price-sort-tag":""),onClick:()=>r(e.title),children:[(0,a.jsx)("p",{className:"tagsFilter-tag-title",children:e.title}),t===e.title&&t.trim()===e.title.trim()&&(0,a.jsx)("button",{className:"tagsFilter-tag-closeButton",style:{display:t===e.title?"block":"none"},children:(0,a.jsxs)("svg",{width:"10",height:"10",viewBox:"0 0 9 10",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,a.jsx)("path",{d:"M1 8.5L8 1.5",stroke:"#ffffff",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),(0,a.jsx)("path",{d:"M8 8.5L1 1.5",stroke:"#ffffff",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})]})})]},e.id))})})},W=(0,x.PA)(e=>{let{activeCustomTag:t,onCustomTagChange:r,activeCategory:o}=e,[l,n]=(0,s.useState)(!1),[i,c]=(0,s.useState)({}),[d,p]=(0,s.useState)(!0),m=(0,s.useRef)([]),[g,h]=(0,s.useState)(0),[x,v]=(0,s.useState)(0),[f,j]=(0,s.useState)(!1),[_,C]=(0,s.useState)([]),[N,b]=(0,s.useState)(null),[y,k]=(0,s.useState)(!1),I=e=>{if(y)return;let a=t.includes(e);e.toLowerCase(),a?r(e):(b(e),k(!0),setTimeout(()=>{r(e),setTimeout(()=>{b(null),k(!1)},400)},200))};if((0,s.useEffect)(()=>{n(!0)},[]),(0,s.useEffect)(()=>{if(!l||d||0===Object.keys(i).length){0===Object.keys(i).length&&C([]);return}let e=setTimeout(()=>{let e=Object.keys(i).length,t=m.current.length>=e;if(t){for(let r=0;r<e;r++)if(!m.current[r]){t=!1;break}}if(t){let t=Array(e);for(let r=0;r<e;r++)t[r]=m.current[r].offsetWidth;C(t)}},50);return()=>clearTimeout(e)},[l,d,i]),(0,s.useEffect)(()=>{if(!l||d||0===Object.keys(i).length||0===_.length||_.length!==Object.keys(i).length)return;let e=()=>{let e=window.innerWidth;e>600&&(e=600);let t=Object.entries(i).length;if(0===t){v(0),h(0);return}let r=function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t,a=0,s=0;for(let t=0;t<r;t++){let r=_[t];if("number"==typeof r){let t=r+5*(a>0);if(s+t<=e)s+=t,a++;else break}else break}return a},a=0,s=0;if(f){a=t;let o=r(e);if(o<t){let t=37+5*(r(e-37)>0),a=r(e-t);s=a>0?a:o}else s=o}else{let o=r(e);if(o<t){let t=37+5*(r(e-37)>0),l=r(e-t);l>0?(a=l,s=l):o>0?(a=o,s=o):(a=0,s=0)}else a=o,s=o}console.log("setVisible: ".concat(a,", setInitial: ").concat(s)),v(s),h(a)},t=setTimeout(e,50);return window.addEventListener("resize",e),()=>{clearTimeout(t),window.removeEventListener("resize",e)}},[l,i,d,f,_]),(0,s.useEffect)(()=>{if(!l)return;let e=setTimeout(()=>{var e,r;let a={};if(!(null==(e=u.data)?void 0:e.overall_product_tags_by_category)){console.log("Данные о тегах категорий не найдены"),c({}),p(!1);return}o?(a=u.data.overall_product_tags_by_category[o]||{},console.log("Теги для категории ".concat(o,":"),a)):(Object.entries(u.data.overall_product_tags_by_category).forEach(e=>{let[,t]=e;t&&Object.entries(t).forEach(e=>{let[t,r]=e;a[t]?a[t]+=r:a[t]=r})}),console.log("Объединенные теги всех категорий:",a));let s=0;if((null==(r=u.data)?void 0:r.products)&&Array.isArray(u.data.products)){let e=u.data.products;if(o){let t=parseInt(o,10);e=e.filter(e=>e.categories&&Array.isArray(e.categories)&&e.categories.some(e=>e.Category_ID===t)),console.log("Фильтрация товаров для категории ".concat(o,", найдено: ").concat(e.length))}let r=t.includes("sale"),l=e.filter(e=>e.marks&&Array.isArray(e.marks)&&e.marks.some(e=>e.Mark_Name&&"sale"===e.Mark_Name.toLowerCase()));if(s=l.length,console.log("Количество товаров со скидкой: ".concat(s)),r&&s>0){let e={};e.sale=s,l.forEach(t=>{t.tags&&Array.isArray(t.tags)&&t.tags.forEach(t=>{"sale"!==t.toLowerCase()&&(e[t]?e[t]++:e[t]=1)})}),console.log("Теги в товарах со скидкой:",e),a=e}else s>0&&(a.sale=s)}c(a),p(!1),a&&Object.keys(a).length>0?h(Object.keys(a).length):h(0),j(!1),v(0)},500);return()=>clearTimeout(e)},[o,u.data,l,t]),!l||d)return(0,a.jsx)("div",{className:"tagsFilter custom-tagsFilter tagsFilter-loading",children:(0,a.jsx)(E,{})});if(0===Object.keys(i).length)return(0,a.jsx)("div",{className:"tagsFilter custom-tagsFilter tagsFilter-empty",children:(0,a.jsx)(E,{})});let w=Object.entries(i).sort((e,r)=>{if("sale"===e[0].toLowerCase())return -1;if("sale"===r[0].toLowerCase())return 1;let a=t.includes(e[0]),s=t.includes(r[0]);return a&&!s?-1:!a&&s?1:0}),S=w.slice(0,0!==g||f||0!==x?g:0),T=!f&&w.length>x&&x>0,A=f&&w.length>x;return(0,a.jsxs)("div",{className:"tagsFilter custom-tagsFilter",children:[(0,a.jsxs)("div",{className:"custom-tagsFilter-tags ".concat(A?"custom-tagsFilter-tags--open":""),children:[S.map((e,r)=>{let[s,o]=e;return(0,a.jsx)("div",{ref:e=>{m.current[r]=e},suppressHydrationWarning:!0,className:"tagsFilter-tag \n                ".concat(t.includes(s)?"tagsFilter-tag--active":""," \n                ").concat("sale"===s.toLowerCase()?"tagsFilter-tag--sale":"","\n                ").concat(N===s?"tagsFilter-tag--moving-front":"","\n                ").concat(N&&N!==s&&r<3?"tagsFilter-tag--shifting":"","\n              "),onClick:()=>I(s),children:(0,a.jsxs)("p",{className:"tagsFilter-tag-title",children:["sale"===s.toLowerCase()?"Sale":s,t.includes(s)?(0,a.jsx)("span",{className:"tagsFilter-tag-close",children:(0,a.jsxs)("svg",{width:"10",height:"10",viewBox:"0 0 9 10",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,a.jsx)("path",{d:"M1 8.5L8 1.5",stroke:"#ffffff",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),(0,a.jsx)("path",{d:"M8 8.5L1 1.5",stroke:"#ffffff",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})]})}):(0,a.jsx)("span",{className:"tagsFilter-tag-count",children:o})]})},r)}),A&&(0,a.jsx)("button",{className:" tagsFilter-hideButton",onClick:()=>{j(!1),h(x)},children:(0,a.jsx)("p",{children:"Скрыть"})})]}),T&&(0,a.jsx)("button",{className:"tagsFilter-moreButton",onClick:()=>{j(!0),h(w.length)},children:(0,a.jsxs)("p",{children:[" Ещё (",w.length-x,")"]})})]})}),H=e=>{let{activeCustomTag:t,activeTag:r,activeCategory:o,setActiveCustomTag:n,setActiveTag:i,setActiveCategory:c,showTagFilter:d,showCategoryFilter:p,showCustomTags:m=!1,handleTagChange:u,handleCategoryChange:g,handleCustomTagChange:h}=e,x=(0,l.useSearchParams)();return(0,s.useEffect)(()=>{x&&x.get("tag")&&i(x.get("tag")),x&&x.get("category")&&c(Number(x.get("category")))},[]),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"filters-panel ".concat(p?"filters-panel--visible":""),suppressHydrationWarning:!0,children:(0,a.jsx)("div",{className:"category-container ".concat(p?"category-container--visible":""),suppressHydrationWarning:!0,children:(0,a.jsx)(F,{activeCategory:o,onCategoryChange:g})})}),(0,a.jsx)("div",{className:"filters-panel ".concat(d?"filters-panel--visible":""),suppressHydrationWarning:!0,children:(0,a.jsx)("div",{className:"tags-container ".concat(d?"tags-container--visible":""),suppressHydrationWarning:!0,children:(0,a.jsx)(R,{activeTag:r,onTagChange:u})})}),(0,a.jsx)("div",{className:"filters-panel custom-filters-panel ".concat(m?"filters-panel--visible":""),suppressHydrationWarning:!0,children:(0,a.jsx)("div",{className:"tags-container ".concat(m?"tags-container--visible":""),suppressHydrationWarning:!0,children:(0,a.jsx)(W,{activeCustomTag:t,onCustomTagChange:h,activeCategory:o?o.toString():null})})})]})};r(6853);let U=(0,x.PA)(e=>{let{onSearch:t,inputRef:r,initialValue:o=""}=e,[l,i]=(0,s.useState)(!1),[c,d]=(0,s.useState)(""),[p,m]=(0,s.useState)(""),u=(0,s.useRef)(null);return(0,s.useEffect)(()=>{i(!0),o&&(d(o),m(o))},[o]),(0,s.useEffect)(()=>{if(l)return u.current&&clearTimeout(u.current),u.current=setTimeout(()=>{m(c)},300),()=>{u.current&&clearTimeout(u.current)}},[c,l]),(0,s.useEffect)(()=>{l&&void 0!==p&&t(p)},[p,t,l]),(0,a.jsx)("div",{className:"search-container",children:(0,a.jsxs)("div",{className:"search",children:[(0,a.jsx)("img",{src:"".concat(n,"search-component-icon.svg"),alt:""}),(0,a.jsx)("input",{type:"text",placeholder:w.ue.$.q,className:"search-input",value:c,onChange:e=>d(e.target.value),ref:r}),c&&(0,a.jsx)("button",{className:"clear-search-btn",onClick:()=>{d(""),m("")},children:"✕"})]})})});r(1360);let q={ACTIVE_CATEGORY:"brandbot_active_category",ACTIVE_TAG:"brandbot_active_tag",ACTIVE_CUSTOM_TAG:"brandbot_active_custom_tag",SHOW_TAG_FILTER:"brandbot_show_tag_filter",SHOW_CUSTOM_TAG_FILTER:"brandbot_show_custom_tag_filter",SEARCH_QUERY:"brandbot_search_query",SHOW_SEARCH:"brandbot_show_search"},V=()=>{let[e,t]=(0,s.useState)(!1),r=(0,l.useSearchParams)(),o=(e,t)=>{{let t=localStorage.getItem(e);if(null!==t)try{return JSON.parse(t)}catch(e){console.error("Ошибка при парсинге данных из localStorage",e)}}return t},[i,c]=(0,s.useState)(""),[d,p]=(0,s.useState)(null),[m,u]=(0,s.useState)(null),[h,x]=(0,s.useState)([]),[v,f]=(0,s.useState)(!0),[j,_]=(0,s.useState)(!1),[C,N]=(0,s.useState)(!1),[b,y]=(0,s.useState)(!1);(0,s.useEffect)(()=>{console.log("URL params:",r?Object.fromEntries(r.entries()):{});let e=e=>{{let t=window.location.hash;if(console.log("Текущий хеш URL:",t),t&&t.includes("?")){let r=new URLSearchParams(t.split("?")[1]).get(e);return console.log("Значение параметра ".concat(e," из хеша:"),r),r}}return null};c(o(q.SEARCH_QUERY,""));let a=r?r.get("category"):null,s=e("category");if(console.log("Параметр category из URL:",a),console.log("Параметр category из хеша:",s),a){let e=parseInt(a,10);console.log("Установка категории из URL параметра:",e),p(e),localStorage.setItem(q.ACTIVE_CATEGORY,JSON.stringify(e))}else if(s){let e=parseInt(s,10);console.log("Установка категории из хеш-параметра:",e),p(e),localStorage.setItem(q.ACTIVE_CATEGORY,JSON.stringify(e))}else p(o(q.ACTIVE_CATEGORY,null));u(o(q.ACTIVE_TAG,null));let l=o(q.ACTIVE_CUSTOM_TAG,[]),n=r?r.get("tag"):null,i=e("tag");console.log("Параметр tag из URL:",n),console.log("Параметр tag из хеша:",i),"sale"===n||"sale"===i?(console.log("Обнаружен параметр tag=sale, устанавливаем кастомный тег sale"),x(["sale"]),N(!0),localStorage.setItem(q.ACTIVE_CUSTOM_TAG,JSON.stringify(["sale"])),localStorage.setItem(q.SHOW_CUSTOM_TAG_FILTER,JSON.stringify(!0))):(x(Array.isArray(l)?l:[]),N(o(q.SHOW_CUSTOM_TAG_FILTER,!1))),_(o(q.SHOW_TAG_FILTER,!1)),y(o(q.SHOW_SEARCH,!1)),t(!0),console.log("Активные фильтры после инициализации:"),console.log("- activeCategory:",o(q.ACTIVE_CATEGORY,null)),console.log("- activeTag:",o(q.ACTIVE_TAG,null)),console.log("- activeCustomTag:","sale"===n||"sale"===i?["sale"]:l),console.log("- showCustomTags:","sale"===n||"sale"===i||o(q.SHOW_CUSTOM_TAG_FILTER,!1))},[r]);let k=(0,s.useRef)(null);return(0,s.useEffect)(()=>{b&&k.current&&setTimeout(()=>{var e;null==(e=k.current)||e.focus()},300)},[b]),(0,a.jsxs)("main",{className:"mt-[20px] px-[10px] w-full catalogMain \n        ".concat(g()?"catalogMain--ios":"","\n        "),children:[(0,a.jsxs)("div",{className:"mb-[13px]",children:[(0,a.jsxs)("div",{className:"catalog-top",children:[(0,a.jsx)("h1",{className:"catalog-top-title",children:w.Qs.U$.D}),(0,a.jsxs)("div",{className:"catalog-top-right",children:[(0,a.jsx)("button",{suppressHydrationWarning:!0,className:"catalog-top-right-button ".concat(e&&b?"active":""),onClick:()=>{y(!b),localStorage.setItem(q.SHOW_SEARCH,JSON.stringify(!b))},children:(0,a.jsx)("img",{src:"".concat(n,"search-icon.svg"),alt:""})}),(0,a.jsx)("button",{suppressHydrationWarning:!0,className:"catalog-top-right-button ".concat(e&&j?"active":""),onClick:()=>{let e=!j;_(e),localStorage.setItem(q.SHOW_TAG_FILTER,JSON.stringify(e))},children:(0,a.jsx)("img",{src:"".concat(n,"sort-icon.svg"),alt:""})}),(0,a.jsx)("button",{suppressHydrationWarning:!0,className:"catalog-top-right-button ".concat(e&&C?"active":""),onClick:()=>{let e=!C;N(e),localStorage.setItem(q.SHOW_CUSTOM_TAG_FILTER,JSON.stringify(e))},children:(0,a.jsx)("img",{src:"".concat(n,"filter-icon.svg"),alt:""})})]})]}),(0,a.jsx)("div",{suppressHydrationWarning:!0,className:"search-panel ".concat(e&&b?"search-panel--visible":""),children:(0,a.jsx)(U,{onSearch:e=>{c(e),localStorage.setItem(q.SEARCH_QUERY,JSON.stringify(e))},inputRef:k,initialValue:i})}),e&&(0,a.jsx)(s.Suspense,{children:(0,a.jsx)(H,{activeTag:m,activeCategory:d,activeCustomTag:h,setActiveTag:u,setActiveCategory:p,showTagFilter:j,showCategoryFilter:!0,showCustomTags:C,handleTagChange:e=>{let t=e===m?null:e;u(t),localStorage.setItem(q.ACTIVE_TAG,JSON.stringify(t))},handleCategoryChange:e=>{let t=e===d?null:e;localStorage.setItem(q.ACTIVE_CUSTOM_TAG,JSON.stringify([])),x([]),p(t),localStorage.setItem(q.ACTIVE_CATEGORY,JSON.stringify(t))},handleCustomTagChange:e=>{let t="sale"===e.toLowerCase();x(r=>{let a;return r.includes(e)?(a=r.filter(t=>t!==e),t&&console.log("Деактивация тега Sale, перезагрузка доступных тегов")):a=[...r,e],localStorage.setItem(q.ACTIVE_CUSTOM_TAG,JSON.stringify(a)),a.length>0&&!C&&(N(!0),localStorage.setItem(q.SHOW_CUSTOM_TAG_FILTER,JSON.stringify(!0))),a})},setActiveCustomTag:x})})]}),(0,a.jsx)(P,{isFavorites:!1,categoryFilter:d,tagFilter:m,customTagFilter:h,searchQuery:i})]})};r(9894);let J=(0,x.PA)(()=>{let e=I.favoritesIds.length>0,[t,r]=(0,s.useState)(100),[o,l]=(0,s.useState)(!1);return(0,s.useEffect)(()=>{let e=()=>{r(window.innerWidth>=480?3:2)};return e(),window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}},[]),(0,s.useEffect)(()=>{l(!!I)},[e]),(0,a.jsx)("main",{className:"favoritesMain \n    ".concat(g()?"favoritesMain--ios":"","\n    "),children:o?e?(0,a.jsx)(P,{isFavorites:!0,limit:t}):(0,a.jsxs)("div",{className:"favoritesMain-empty",children:[(0,a.jsx)("h2",{className:"favoritesMain-empty-title",children:"У вас пока нет избранных товаров"}),(0,a.jsxs)("p",{className:"favoritesMain-empty-text",children:["Нажмите на"," ",(0,a.jsx)("svg",{width:"18",height:"16",viewBox:"0 0 18 16",fill:"transparent",xmlns:"http://www.w3.org/2000/svg",style:{display:"inline-block"},children:(0,a.jsx)("path",{d:"M9.30663 14.7267L9.30662 14.7267L9.30029 14.7289C9.24983 14.7467 9.14099 14.7668 8.99996 14.7668C8.85893 14.7668 8.75009 14.7467 8.69963 14.7289L8.69964 14.7289L8.69329 14.7267C7.57825 14.346 5.71238 13.3333 4.13388 11.716C2.56322 10.1067 1.31663 7.94228 1.31663 5.24183C1.31663 3.02277 3.10364 1.2335 5.29996 1.2335C6.60123 1.2335 7.75317 1.86153 8.47812 2.8377C8.60075 3.00282 8.79429 3.10016 8.99996 3.10016C9.20563 3.10016 9.39917 3.00282 9.5218 2.8377C10.2464 1.86206 11.4064 1.2335 12.7 1.2335C14.8963 1.2335 16.6833 3.02277 16.6833 5.24183C16.6833 7.94228 15.4367 10.1067 13.866 11.716C12.2875 13.3333 10.4217 14.346 9.30663 14.7267Z",stroke:"#6C6C6C",strokeWidth:"1.3",strokeLinecap:"round",strokeLinejoin:"round"})}),", чтобы сохранить любой понравившийся товар"]})]}):(0,a.jsx)(E,{})})});var z=r(414),G=r(3765),Y=r.n(G);r(6153);let Q=e=>{let{message:t,onClose:r,onRetry:s}=e;return t?(0,a.jsx)("div",{className:"error-modal-overlay",onClick:r,children:(0,a.jsxs)("div",{className:"error-modal",onClick:e=>e.stopPropagation(),children:[(0,a.jsx)("button",{className:"error-modal-close",onClick:r,children:(0,a.jsx)("img",{src:"".concat(n,"close-icon.svg"),alt:"Закрыть"})}),(0,a.jsxs)("div",{className:"error-modal-content",children:[(0,a.jsx)("h3",{className:"error-modal-title",children:"Ошибка"}),(0,a.jsx)("p",{className:"error-modal-message",children:t}),(0,a.jsxs)("div",{className:"error-modal-buttons",children:[(0,a.jsx)("button",{className:"error-modal-button",onClick:r,children:"Закрыть"}),s&&(0,a.jsx)("button",{className:"error-modal-button error-modal-retry",onClick:s,children:"Повторить"})]})]})]})}):null},Z=e=>{var t,r,s,o,l,i,c,d;let{onClose:p,orderResponse:m,orderProducts:g,onPay:h}=e,x=(null==(r=u.data)||null==(t=r.special_project_parameters)?void 0:t.PAYMENT_SYSTEM_INSERT_TEXT_description)||"",v=(null==(o=u.data)||null==(s=o.special_project_parameters)?void 0:s.PAYMENT_SYSTEM_INSERT_TEXT_extra_field_1)||"",f=parseFloat((null==m?void 0:m.payment_type)==="delivery"?null==(i=u.data)||null==(l=i.special_project_parameters)?void 0:l.cart_delivery_price_offline_value:null==(d=u.data)||null==(c=d.special_project_parameters)?void 0:c.cart_delivery_price_value)||0;return(0,a.jsx)("div",{className:"error-modal-overlay",onClick:p,children:(0,a.jsxs)("div",{className:"error-modal order-success-modal",onClick:e=>e.stopPropagation(),children:[(0,a.jsx)("button",{className:"error-modal-close",onClick:p,children:(0,a.jsx)("img",{src:"".concat(n,"close-icon.svg"),alt:"Закрыть"})}),(0,a.jsxs)("div",{className:"success-modal-content",children:[(0,a.jsxs)("div",{className:"success-top-info",children:[(0,a.jsx)("div",{dangerouslySetInnerHTML:{__html:x}}),(null==m?void 0:m.order_id)&&(0,a.jsxs)("div",{className:"order-id",children:["Заказ: № ",m.order_id]})]}),(0,a.jsx)("div",{className:"order-products-container",children:g.map((e,t)=>{var r;return(0,a.jsxs)("div",{className:"order-product-item",children:[(0,a.jsx)("div",{className:"order-product-image",children:(0,a.jsx)("img",{src:(null==(r=e.selectedColor)?void 0:r.image)||e.images[0].Image_URL,alt:e.Product_Name})}),(0,a.jsxs)("div",{className:"order-product-info",children:[(0,a.jsx)("div",{className:"order-product-name",children:e.Product_Name}),e.parameters&&(0,a.jsxs)("div",{className:"order-product-size",children:["Размер обуви"===e.parameters.name?"Размер":e.parameters.name,": ",e.parameters.parameter_string]}),e.selectedColor&&(0,a.jsxs)("div",{className:"order-product-color",children:["Цвет: ",e.selectedColor.name,(0,a.jsx)("span",{className:"color-dot",style:{backgroundColor:e.selectedColor.code||"#ccc"}})]}),(0,a.jsxs)("div",{className:"order-product-price",children:[e.final_price||e.parameters.price," ₽"]})]}),(0,a.jsxs)("div",{className:"order-product-quantity",children:["x",e.quantity||1]})]},t)})}),(0,a.jsxs)("div",{className:"order-total",children:[(0,a.jsx)("div",{className:"order-total-text",children:"Итого:"}),(0,a.jsxs)("div",{className:"order-total-price",children:[g.reduce((e,t)=>e+t.parameters.price*(t.quantity||1),0)+f," ","₽"]})]}),(null==m?void 0:m.payment_link)&&(0,a.jsxs)("div",{className:"payment-link-container",children:[(0,a.jsx)("p",{className:"payment-link-label",children:"Ваша ссылка на оплату:"}),(0,a.jsx)("a",{href:m.payment_link,target:"_blank",rel:"noopener noreferrer",className:"payment-link-button",onClick:h,children:(0,a.jsx)("span",{className:"payment-link-text",children:"ОПЛАТИТЬ"})}),(0,a.jsx)("p",{className:"payment-link-help",children:"Если ссылка не открылась автоматически, пожалуйста, нажмите на неё повторно."})]}),(0,a.jsx)("div",{dangerouslySetInnerHTML:{__html:v},className:"payment-extra-info"})]})]})})},K=e=>{var t,r,s,o,l,i,c,d;let{onClose:p,orderResponse:m,orderProducts:g,managerContact:h,onContactClick:x}=e,v=(null==(r=u.data)||null==(t=r.special_project_parameters)?void 0:t.PAYMENT_SYSTEM_INSERT_TEXT_description)||"",f=parseFloat(null==(o=u.data)||null==(s=o.special_project_parameters)?void 0:s.cart_delivery_price_offline_value)||0;null==(i=u.data)||null==(l=i.special_project_parameters)||l.manager_button_text;let j=(null==(d=u.data)||null==(c=d.special_project_parameters)?void 0:c.manager_display_contact)||h,_=(e=>{if(!e)return"#";let t=e.replace(/^@/,"");return e.startsWith("@")||e.includes("t.me/")?"https://t.me/".concat(t):e.includes("wa.me/")||e.includes("whatsapp")?"https://wa.me/".concat(t.replace(/\D/g,"")):e.includes("vk.com")?"https://vk.com/".concat(t.replace("vk.com/","")):/^[+\d\s()-]{10,}$/.test(e)?"https://wa.me/".concat(t.replace(/\D/g,"")):"https://t.me/".concat(t)})(h);return(0,a.jsx)("div",{className:"error-modal-overlay",onClick:p,children:(0,a.jsxs)("div",{className:"error-modal order-success-modal",onClick:e=>e.stopPropagation(),children:[(0,a.jsx)("button",{className:"error-modal-close",onClick:p,children:(0,a.jsx)("img",{src:"".concat(n,"close-icon.svg"),alt:"Закрыть"})}),(0,a.jsxs)("div",{className:"success-modal-content",children:[(0,a.jsxs)("div",{className:"success-top-info",children:[(0,a.jsx)("div",{dangerouslySetInnerHTML:{__html:v}}),(null==m?void 0:m.order_id)&&(0,a.jsxs)("div",{className:"order-id",children:["Заказ: № ",m.order_id]})]}),(0,a.jsx)("div",{className:"order-products-container",children:g.map((e,t)=>{var r;return(0,a.jsxs)("div",{className:"order-product-item",children:[(0,a.jsx)("div",{className:"order-product-image",children:(0,a.jsx)("img",{src:(null==(r=e.selectedColor)?void 0:r.image)||e.images[0].Image_URL,alt:e.Product_Name})}),(0,a.jsxs)("div",{className:"order-product-info",children:[(0,a.jsx)("div",{className:"order-product-name",children:e.Product_Name}),e.parameters&&(0,a.jsxs)("div",{className:"order-product-size",children:["Размер обуви"===e.parameters.name?"Размер":e.parameters.name,": ",e.parameters.parameter_string]}),e.selectedColor&&(0,a.jsxs)("div",{className:"order-product-color",children:["Цвет: ",e.selectedColor.name,(0,a.jsx)("span",{className:"color-dot",style:{backgroundColor:e.selectedColor.code||"#ccc"}})]}),(0,a.jsxs)("div",{className:"order-product-price",children:[e.final_price||e.parameters.price," ₽"]})]}),(0,a.jsxs)("div",{className:"order-product-quantity",children:["x",e.quantity||1]})]},t)})}),(0,a.jsxs)("div",{className:"order-total",children:[(0,a.jsx)("div",{className:"order-total-text",children:"Итого:"}),(0,a.jsxs)("div",{className:"order-total-price",children:[g.reduce((e,t)=>{var r;return e+(t.final_price||(null==(r=t.parameters)?void 0:r.price)||0)*(t.quantity||1)},0)+f," ","₽"]})]}),(0,a.jsxs)("div",{className:"contact-manager-container",children:[(0,a.jsx)("p",{className:"contact-manager-text",children:"Для оплаты заказа свяжитесь с менеджером:"}),(0,a.jsxs)("a",{href:_,target:"_blank",rel:"noopener noreferrer",className:"contact-manager-button",onClick:x,children:[(0,a.jsx)("div",{className:"contact-manager-telegram-icon",children:(0,a.jsxs)("svg",{width:"25",height:"24",viewBox:"0 0 25 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,a.jsxs)("g",{clipPath:"url(#a)",fillRule:"evenodd",clipRule:"evenodd",children:[(0,a.jsx)("path",{d:"M24.5 12c0-6.628-5.372-12-12-12S.5 5.372.5 12s5.372 12 12 12 12-5.372 12-12",fill:"url(#b)"}),(0,a.jsx)("path",{d:"m5.666 11.297 7.797-3.238c.77-.338 3.381-1.417 3.381-1.417s1.205-.473 1.105.675c-.034.472-.302 2.124-.57 3.912l-.836 5.295s-.067.776-.636.911-1.506-.472-1.673-.607c-.134-.101-2.51-1.619-3.38-2.36-.235-.203-.503-.608.033-1.08a129 129 0 0 0 3.514-3.373c.402-.405.804-1.35-.87-.203l-4.719 3.205s-.535.337-1.54.033c-1.003-.303-2.175-.708-2.175-.708s-.803-.506.57-1.045z",fill:"#fff"})]}),(0,a.jsxs)("defs",{children:[(0,a.jsxs)("linearGradient",{id:"b",x1:"55.831",y1:"13.231",x2:"34.179",y2:"61.344",gradientUnits:"userSpaceOnUse",children:[(0,a.jsx)("stop",{stopColor:"#37AEE2"}),(0,a.jsx)("stop",{offset:"1",stopColor:"#1E96C8"})]}),(0,a.jsx)("clipPath",{id:"a",children:(0,a.jsx)("path",{fill:"#fff",d:"M.5 0h24v24H.5z"})})]})]})}),(0,a.jsx)("span",{className:"contact-manager-text",children:j})]}),(0,a.jsx)("p",{className:"contact-manager-instructions",children:"Укажите номер заказа при общении с менеджером для быстрой обработки."})]})]})]})})},$=e=>{var t,r,s,o,l,i;let{onClose:c,orderResponse:d,orderProducts:p,onConfirm:m}=e,g=(null==(r=u.data)||null==(t=r.special_project_parameters)?void 0:t.PAYMENT_SYSTEM_INSERT_TEXT_description)||'<p class="cart-link-popup-imitator-container-thanksForOrder">Спасибо за заказ!</p>',h=(null==(o=u.data)||null==(s=o.special_project_parameters)?void 0:s.PAYMENT_SYSTEM_INSERT_TEXT_extra_field_1)||"",x=parseFloat(null==(i=u.data)||null==(l=i.special_project_parameters)?void 0:l.cart_delivery_price_value)||0;return(0,a.jsx)("div",{className:"error-modal-overlay",onClick:c,children:(0,a.jsxs)("div",{className:"error-modal order-success-modal softpay-modal",onClick:e=>e.stopPropagation(),children:[(0,a.jsx)("button",{className:"error-modal-close",onClick:c,children:(0,a.jsx)("img",{src:"".concat(n,"close-icon.svg"),alt:"Закрыть"})}),(0,a.jsxs)("div",{className:"success-modal-content",children:[(0,a.jsxs)("div",{className:"success-top-info",children:[(0,a.jsx)("div",{dangerouslySetInnerHTML:{__html:g}}),(null==d?void 0:d.order_id)&&(0,a.jsxs)("div",{className:"order-id",children:["Заказ № ",d.order_id]})]}),(0,a.jsx)("div",{className:"order-products-container",children:p.map((e,t)=>{var r;return(0,a.jsxs)("div",{className:"order-product-item",children:[(0,a.jsx)("div",{className:"order-product-image",children:(0,a.jsx)("img",{src:(null==(r=e.selectedColor)?void 0:r.image)||e.images[0].Image_URL,alt:e.Product_Name})}),(0,a.jsxs)("div",{className:"order-product-info",children:[(0,a.jsx)("div",{className:"order-product-name",children:e.Product_Name}),e.parameters&&(0,a.jsxs)("div",{className:"order-product-size",children:["Размер обуви"===e.parameters.name?"Размер":e.parameters.name,": ",e.parameters.parameter_string]}),e.selectedColor&&(0,a.jsxs)("div",{className:"order-product-color",children:["Цвет: ",e.selectedColor.name,(0,a.jsx)("span",{className:"color-dot",style:{backgroundColor:e.selectedColor.code||"#ccc"}})]}),(0,a.jsxs)("div",{className:"order-product-price",children:[e.final_price||e.parameters.price," ₽"]})]}),(0,a.jsxs)("div",{className:"order-product-quantity",children:["x",e.quantity||1]})]},t)})}),(0,a.jsxs)("div",{className:"order-total",children:[(0,a.jsx)("div",{className:"order-total-text",children:"Итого:"}),(0,a.jsxs)("div",{className:"order-total-price",children:[p.reduce((e,t)=>e+t.parameters.price*(t.quantity||1),0)+x," ","₽"]})]}),(0,a.jsx)("div",{className:"payment-instructions-softpay",dangerouslySetInnerHTML:{__html:h}}),(0,a.jsx)("button",{className:"error-modal-button softpay-confirm-button",onClick:m,children:"Хорошо"})]})]})})},X=(0,x.PA)(()=>{var e,t,r,l,p,m,h,x,v,j,_;let[C,N]=(0,s.useState)(1),[b,y]=(0,s.useState)(!1),[k,I]=(0,s.useState)(!1),[w,S]=(0,s.useState)(!1),[T,A]=(0,s.useState)(!1),[L,D]=(0,s.useState)("pending"),[M,O]=(0,s.useState)(!1),[F,B]=(0,s.useState)(null),[R,W]=(0,s.useState)([]),[H,U]=(0,s.useState)(null),[q,V]=(0,s.useState)(""),[J,G]=(0,s.useState)(""),[X,ee]=(0,s.useState)(""),[et,er]=(0,s.useState)(""),[ea,es]=(0,s.useState)(""),[eo,el]=(0,s.useState)(""),[en,ei]=(0,s.useState)(""),[ec,ed]=(0,s.useState)(""),[ep,em]=(0,s.useState)(""),[eu,eg]=(0,s.useState)(""),[eh,ex]=(0,s.useState)(""),[ev,ef]=(0,s.useState)(""),[ej,e_]=(0,s.useState)(""),[eC,eN]=(0,s.useState)(""),[eb,ey]=(0,s.useState)(""),[ek,eI]=(0,s.useState)(""),[ew,eS]=(0,s.useState)(2),eT=e=>e?e.includes("_")||e.length<18?(ee("Введите полный номер телефона"),!1):(ee(""),!0):(ee(""),!1),eA=()=>{V(""),eg(""),ef(""),e_(""),eN(""),ex(""),ey(""),eI(""),G(""),ee(""),er(""),es(""),el(""),ei(""),ed(""),em("")},eE=()=>{eS(window.innerWidth>=480?3:2)},eP=()=>f.items.reduce((e,t)=>e+t.parameters.price*(t.quantity||1),0),eL=((null==(e=u.data)?void 0:e.special_project_parameters_actions)||[]).find(e=>"p23"===e.action_type),eD=eL?Number(eL.extra_field_1):0,eM=eL?Number(eL.extra_field_2):0,eO=()=>{let e=f.items.reduce((e,t)=>e+(t.quantity||1),0);return!eL||e<2?0:2===e?Math.ceil(eP()*(eD/100)):Math.ceil(eP()*(eM/100))};null===z.OJ||void 0===z.OJ||null==(t=z.OJ.products)||t.filter(e=>!0===e.OnMain).slice(0,4);let eF=e=>{e.preventDefault(),e.stopPropagation()},eB=(e,t,r)=>{{let o=localStorage.getItem("addedSettingItems");if(o)try{let l=JSON.parse(o);console.log("Удаление из локального хранилища",{productId:e,productTitle:t,colorId:r}),console.log("Текущие элементы в localStorage:",l);let n=f.items.find(a=>{var s,o;return a.Product_ID===e&&(!t||(null==(s=a.parameters)?void 0:s.parameter_string)===t)&&(!r||(null==(o=a.selectedColor)?void 0:o.id)===r)});if(n){var a,s;let t=null==(a=n.parameters)?void 0:a.Parameter_ID,r=null==(s=n.selectedColor)?void 0:s.id;console.log("Найден товар для удаления:",{productId:e,paramId:t,productColorId:r,itemParams:n.parameters,itemColor:n.selectedColor});let o=l.filter(a=>{let s=a.productId!==e,o=t&&a.id!==t,l=r&&a.colorId!==r,n=s||o||l;return console.log("Проверка элемента #".concat(a.productId,":"),{differentProduct:s,differentParam:o,differentColor:l,keepItem:n}),n});console.log("Отфильтрованные элементы:",o),localStorage.setItem("addedSettingItems",JSON.stringify(o)),console.log("Товар с ID ".concat(e,", параметром ").concat(t||"без параметра"," ").concat(r?"и цветом ID ".concat(r):""," удален из localStorage"))}else console.log("Не найден товар с ID ".concat(e,', параметром "').concat(t,'" ').concat(r?"и цветом ID ".concat(r):""," в корзине"))}catch(e){console.error("Ошибка при обработке данных из localStorage:",e)}}},eR=(e,t,r,a)=>{console.log('Удаление товара "'.concat(t,'" из корзины:'),{productId:e,parameterString:r,colorId:a}),eB(e,r||"",a),(0,i.h5)(()=>{let t=f.items.length;f.items=f.items.filter(t=>{var s,o;let l=t.Product_ID===e,n=!r||(null==(s=t.parameters)?void 0:s.parameter_string)===r,i=!a||(null==(o=t.selectedColor)?void 0:o.id)===a;return!(l&&n&&i)}),console.log("Удалено ".concat(t-f.items.length," товаров из корзины"))});let s=a?" и цветом ID: ".concat(a):"";console.log('Товар "'.concat(t,'" ').concat(r?"(".concat(r,")"):"").concat(s," с ID ").concat(e," удален из корзины"))},eW=()=>{let e=!0,t=[];return G(""),ee(""),er(""),es(""),em(""),q.trim()||(G("error"),e=!1,t.push("ФИО")),(!eu||eu.includes("_")||eu.length<18)&&(ee("error"),e=!1,t.push("Телефон")),ev.trim()||(er("error"),e=!1,t.push("Город и улица")),ej.trim()||(es("error"),e=!1,t.push("Дом")),0===f.items.length?(em("Корзина пуста. Добавьте товары для оформления заказа."),I(!0),e=!1):t.length>0&&(em("Пожалуйста, заполните следующие поля: ".concat(t.join(", "))),I(!0)),e},eH=()=>{var e,t,r,a;return parseFloat(b&&2===C?null==(t=u.data)||null==(e=t.special_project_parameters)?void 0:e.cart_delivery_price_offline_value:null==(a=u.data)||null==(r=a.special_project_parameters)?void 0:r.cart_delivery_price_value)||0},eU=async()=>{var e,t,r,a;if(!eW())return;O(!0),console.log("Оформление заказа..."),f.items.filter(e=>e.quantity&&e.quantity>0).map(e=>{var t,r,a;let s=Math.max(0,((null==(t=e.parameters)?void 0:t.price)||e.Price||0)-((null==(r=e.selectedColor)?void 0:r.discount)||0));return{ID:e.Product_ID,name:e.Name,price:s,quantity:e.quantity||0,parameter:(null==(a=e.parameters)?void 0:a.parameter_string)||"",color:e.selectedColor?{name:e.selectedColor.name,code:e.selectedColor.code}:null}});let s=eu?eu.replace(/[^\d+]/g,""):"",o=f.items.map(e=>{var t,r;let a={product_id:e.Product_ID,parameter_id:(null==(t=e.parameters)?void 0:t.Parameter_ID)||0,quantity:e.quantity||1};return(null==(r=e.selectedColor)?void 0:r.id)&&(a.color=e.selectedColor.id),a});console.log("Товары для API:",o);let l={tg_user_id:(null==(a=window.Telegram)||null==(r=a.WebApp)||null==(t=r.initDataUnsafe)||null==(e=t.user)?void 0:e.id)||0x2cb3f70b,fio:q,phone:s,city:ev,house:ej,apartment:eC,payment_type:b&&2===C?"delivery":"online",promocode:ek||"",products:o};console.log("Отправка заказа:",JSON.stringify(l,null,2)),U(l);try{D(!0),console.log("Отправка заказа на API...");let e=await d.post("/order",l);console.log("Ответ API:",e.data);let t=[...f.items];W(t),B(e.data),(0,i.h5)(()=>{f.items=[],localStorage.removeItem("addedSettingItems"),console.log("Корзина очищена после оформления заказа")}),S(!0),D(!1),O(!1)}catch(t){console.error("Ошибка при размещении заказа:",t);let e="Не удалось отправить заказ. Пожалуйста, попробуйте позже.";t.response?(console.error("Ошибка ответа от сервера:",t.response.data),t.response.data&&"object"==typeof t.response.data&&"message"in t.response.data?e=t.response.data.message:400===t.response.status?e="Некорректные данные заказа. Пожалуйста, проверьте введенную информацию.":401===t.response.status?e="Необходима авторизация для оформления заказа.":500===t.response.status&&(e="Внутренняя ошибка сервера. Пожалуйста, попробуйте позже.")):t.request&&(console.error("Нет ответа от сервера:",t.request),e="Сервер не отвечает. Пожалуйста, проверьте ваше соединение с интернетом."),em(e),I(!0),D(!1),O(!1)}},eq=()=>{{let e=Object.keys(localStorage),t=["DataStore","FavoritesStore","ShoppingCartStore"];e.forEach(e=>{t.includes(e)||localStorage.removeItem(e)}),console.log("LocalStorage очищен, кроме первых трех ключей")}},eV=()=>{S(!1)},eJ=async()=>{if(!H){em("Не удалось повторить отправку заказа. Попробуйте снова заполнить форму."),I(!0);return}O(!0),I(!1);try{console.log("Повторная отправка заказа на API...");let e=await c.A.post("https://noxer-ai.ru/api/orders",H);console.log("Ответ API:",e.data),B(e.data),(0,i.h5)(()=>{f.items=[],localStorage.removeItem("addedSettingItems"),console.log("Корзина очищена после оформления заказа")}),S(!0),D(!1),O(!1),U(null)}catch(t){console.error("Ошибка при повторной отправке заказа:",t);let e="Не удалось отправить заказ. Пожалуйста, попробуйте позже.";t.response?(console.error("Ошибка ответа от сервера:",t.response.data),t.response.data&&"object"==typeof t.response.data&&"message"in t.response.data?e=t.response.data.message:400===t.response.status?e="Некорректные данные заказа. Пожалуйста, проверьте введенную информацию.":401===t.response.status?e="Необходима авторизация для оформления заказа.":500===t.response.status&&(e="Внутренняя ошибка сервера. Пожалуйста, попробуйте позже.")):t.request&&(console.error("Нет ответа от сервера:",t.request),e="Сервер не отвечает. Пожалуйста, проверьте ваше соединение с интернетом."),em(e),I(!0),D(!1),O(!1)}};return(0,s.useEffect)(()=>{var e,t;A(g()),eE(),window.addEventListener("resize",eE);let r=(null==(t=u.data)||null==(e=t.special_project_parameters)?void 0:e.cart_allow_post_payment_value)==="yes";return y(r),r||N(1),()=>{window.removeEventListener("resize",eE)}},[u.data]),(0,s.useEffect)(()=>{0===f.items.length?D(!1):D(!0)},[f.items]),(0,a.jsxs)("main",{"data-page":"cart",className:"mt-[15px] px-[10px] w-full shoppingCart-main ".concat(T?"shoppingCart-main--ios":""),children:[k&&(0,a.jsx)(Q,{message:ep,onClose:()=>{I(!1)},onRetry:H?eJ:void 0}),w&&(null==(l=u.data)||null==(r=l.special_project_parameters)?void 0:r.PAYMENT_SYSTEM_value)==="yokassa"&&(0,a.jsx)(Z,{onClose:eV,orderResponse:F,orderProducts:R,onPay:()=>{eA(),f.clearCart(),eq(),S(!1)}}),w&&(null==(m=u.data)||null==(p=m.special_project_parameters)?void 0:p.PAYMENT_SYSTEM_value)==="no"&&(0,a.jsx)(K,{onClose:eV,orderResponse:F,orderProducts:R,managerContact:null==(x=u.data)||null==(h=x.special_project_parameters)?void 0:h.telegram_manager_contact_value,onContactClick:()=>{console.log("Клик по контакту с менеджером"),eA(),f.clearCart(),eq(),S(!1);try{if(window.Telegram&&window.Telegram.WebApp){var e,t;console.log("Используем Telegram WebApp для открытия ссылки");let r=null==(t=u.data)||null==(e=t.special_project_parameters)?void 0:e.telegram_manager_contact_value;if(r){let e=r.replace(/^@/,"");return window.Telegram.WebApp.openLink("https://t.me/".concat(e)),!1}}else console.log("Telegram WebApp не найден, продолжаем стандартным способом")}catch(e){console.error("Ошибка при попытке использовать Telegram WebApp:",e)}}}),w&&(null==(j=u.data)||null==(v=j.special_project_parameters)?void 0:v.PAYMENT_SYSTEM_value)==="softpay"&&(0,a.jsx)($,{onClose:eV,orderResponse:F,orderProducts:R,onConfirm:()=>{eA(),f.clearCart(),eq(),S(!1)}}),"pending"===L?(0,a.jsx)(E,{}):(0,a.jsxs)(a.Fragment,{children:[!0===L&&(0,a.jsxs)("div",{className:"shoppingCart-header",children:[(0,a.jsx)("h1",{className:"shoppingCart-header-title",children:"Корзина"}),f.items.length>0&&(0,a.jsx)("button",{onClick:()=>{f.clearCart(),eq()},className:"shoppingCart-header-button",children:"Очистить корзину"})]}),!1===L?(0,a.jsxs)("div",{className:"empty-cart  \n                ".concat(g()?"empty-cart--ios":"","\n                "),children:[(0,a.jsxs)("div",{className:"empty-cart-text",children:[(0,a.jsx)("p",{className:"empty-cart-message",children:"Корзина пуста"}),(0,a.jsxs)("p",{className:"empty-cart-suggestion",children:["Воспользуйтесь каталогом ",(0,a.jsx)("br",{})," или поиском для выбора товаров"]})]}),(0,a.jsxs)("div",{className:"recommended-products",children:[(0,a.jsx)("h2",{className:"recommended-title",children:"Рекомендуем"}),(0,a.jsx)("div",{className:"limited-products-grid",children:(0,a.jsx)(P,{isFavorites:!1,limit:ew})})]})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"shoppingCart-productsContainer",children:null==(_=f.items)?void 0:_.map((e,t)=>{var r,s;return(0,a.jsxs)(o.k2,{to:"/product/".concat(e.Product_ID),className:"shoppingCart-product",children:[(0,a.jsx)("div",{onClick:eF,className:"shoppingCart-product-image-container",children:(0,a.jsx)("img",{className:"shoppingCart-product-image",src:(null==(r=e.selectedColor)?void 0:r.image)||e.images[0].Image_URL,alt:""})}),(0,a.jsxs)("div",{className:"shoppingCart-product-info",children:[(0,a.jsxs)("div",{className:"shoppingCart-product-nameSize",children:[(0,a.jsx)("div",{className:"shoppingCart-product-name",children:e.Product_Name}),e.parameters&&(0,a.jsxs)("div",{className:"shoppingCart-product-size",children:["Размер обуви"===e.parameters.name?"Размер":e.parameters.name,": ",e.parameters.parameter_string]}),e.selectedColor&&(0,a.jsxs)("div",{className:"shoppingCart-product-color",children:["Цвет:"," ",(0,a.jsx)("span",{className:"color-name",children:e.selectedColor.name}),(0,a.jsx)("span",{className:"color-dot",style:{backgroundColor:e.selectedColor.code||"#ccc"}})]})]}),(0,a.jsxs)("div",{className:"shoppingCart-product-priceQuantity",children:[(0,a.jsxs)("div",{className:"shoppingCart-product-priceWrapper",children:[(0,a.jsxs)("p",{className:"shoppingCart-product-price",children:[e.final_price||e.parameters.price," ₽"]}),(null==(s=e.selectedColor)?void 0:s.discount)>0&&(0,a.jsxs)("p",{className:"shoppingCart-product-oldPrice",children:[e.parameters.price," ₽"]})]}),(0,a.jsxs)("div",{className:"shoppingCart-product-quantityControl",onClick:eF,children:[(0,a.jsx)("button",{type:"button",onClick:()=>{var t,r;return f.decreaseQuantity(e.Product_ID,null==(t=e.parameters)?void 0:t.parameter_string,null==(r=e.selectedColor)?void 0:r.id)},className:"shoppingCart-product-quantityControl-button",children:"-"}),(0,a.jsx)("p",{className:"shoppingCart-product-quantityControl-value",children:e.quantity||1}),(0,a.jsx)("button",{type:"button",onClick:()=>{var t,r;return f.increaseQuantity(e.Product_ID,null==(t=e.parameters)?void 0:t.parameter_string,null==(r=e.selectedColor)?void 0:r.id)},className:"shoppingCart-product-quantityControl-button",children:"+"})]})]})]}),(0,a.jsx)("button",{type:"button",onClick:t=>{var r,a;t.preventDefault(),t.stopPropagation(),eR(e.Product_ID,e.Product_Name,null==(r=e.parameters)?void 0:r.parameter_string,null==(a=e.selectedColor)?void 0:a.id)},className:"shoppingCart-product-delete",children:(0,a.jsx)("img",{src:"".concat(n,"close-icon.svg"),alt:"",className:"shoppingCart-product-delete-icon"})})]},t)})}),(0,a.jsxs)("form",{className:"shoppingCart-form",children:[(0,a.jsxs)("div",{className:"shoppingCart-form-contactInfo",children:[(0,a.jsx)("h2",{className:"shoppingCart-form-contactInfo-title",children:"Контактная информация"}),(0,a.jsxs)("div",{className:"shoppingCart-form-contactInfo-fieldsContainer",children:[(0,a.jsx)("div",{className:"input-wrapper",children:(0,a.jsx)("input",{type:"text",placeholder:"ФИО",value:q,onChange:e=>{let t=e.target.value;/^[а-яА-ЯёЁa-zA-Z\s-]*$/.test(t)?(V(t),J&&G("")):G("Только буквы и пробелы")},className:"shoppingCart-form-contactInfo-fieldsContainer-input ".concat(J?"input-error":"")})}),(0,a.jsx)("div",{className:"input-wrapper",children:(0,a.jsx)(Y(),{mask:["+","7"," ","(",/[0-9]/,/[0-9]/,/[0-9]/,")"," ",/[0-9]/,/[0-9]/,/[0-9]/," ",/[0-9]/,/[0-9]/,"-",/[0-9]/,/[0-9]/],placeholder:"+7 (___) ___ __-__",guide:!0,value:eu,onChange:e=>{let t=e.target.value;eg(t),eT(t)},type:"tel",className:"shoppingCart-form-contactInfo-fieldsContainer-input ".concat(X?"input-error":"")})})]})]}),(0,a.jsxs)("div",{className:"shoppingCart-form-deliveryInfo",children:[(0,a.jsx)("h2",{className:"shoppingCart-form-deliveryInfo-title",children:"Способ доставки"}),(0,a.jsxs)("button",{type:"button",className:"shoppingCart-form-deliveryInfo-cdekButton",children:[(0,a.jsxs)("div",{className:"shoppingCart-form-deliveryInfo-cdekButton-top",children:[(0,a.jsx)("img",{src:"".concat(n,"cdek-icon.svg"),alt:""}),(0,a.jsx)("p",{className:"shoppingCart-form-deliveryInfo-cdekButton-top-text",children:"(выбор 97% клиентов)"})]}),(0,a.jsx)("p",{className:"shoppingCart-form-deliveryInfo-cdekButton-text",children:'Доставка осуществляется транспортной компанией CDEK по тарифам компании. Нажмите "Выбрать адрес" и выберите пункт выдачи на карте'}),(0,a.jsx)("img",{src:"".concat(n,"payment-choiced-icon.svg"),alt:"",className:"shoppingCart-form-deliveryInfo-cdekButton-icon"})]}),(0,a.jsx)("h3",{className:"shoppingCart-form-deliveryInfo-addressTitle",children:"Адрес доставки (или СДЕК)"}),(0,a.jsxs)("div",{className:"shoppingCart-form-deliveryInfo-addressInputsContainer",children:[(0,a.jsx)("input",{type:"text",placeholder:"Город и улица",value:ev,onChange:e=>{let t=e.target.value;ef(t),t.trim()?er(""):er("Введите город и улицу")},className:"shoppingCart-form-deliveryInfo-fullWidthInput ".concat(et?"input-error":"")}),(0,a.jsxs)("div",{className:"shoppingCart-form-deliveryInfo-inputsRow",children:[(0,a.jsx)("div",{className:"input-wrapper",children:(0,a.jsx)("input",{type:"text",placeholder:"Дом",value:ej,onChange:e=>{let t=e.target.value;e_(t),t.trim()?es(""):es("Введите номер дома")},className:"shoppingCart-form-deliveryInfo-halfWidthInput ".concat(ea?"input-error":"")})}),(0,a.jsx)("input",{type:"text",placeholder:"Квартира",value:eC,onChange:e=>eN(e.target.value),className:"shoppingCart-form-deliveryInfo-halfWidthInput"})]})]}),(0,a.jsx)("input",{type:"text",placeholder:"Комментарий к заказу",onChange:e=>ey(e.target.value),className:"shoppingCart-form-deliveryInfo-commentField"})]}),b&&(0,a.jsxs)("div",{className:"shoppingCart-form-paymentType",children:[(0,a.jsx)("h2",{className:"shoppingCart-form-paymentType-title",children:"Тип оплаты"}),(0,a.jsxs)("div",{className:"shoppingCart-form-paymentType-buttons",children:[(0,a.jsxs)("button",{type:"button",onClick:()=>N(1),className:"shoppingCart-form-paymentType-button ".concat(1===C&&"shoppingCart-form-paymentType-button--active"),children:[(0,a.jsx)("p",{className:"shoppingCart-form-paymentType-text",children:"Оплата онлайн в приложении"}),(0,a.jsx)("div",{className:"shoppingCart-form-paymentType-checkbox",children:1===C&&(0,a.jsx)("img",{src:"".concat(n,"payment-choiced-icon.svg"),alt:"",className:"shoppingCart-form-paymentType-icon"})})]}),(0,a.jsxs)("button",{type:"button",onClick:()=>N(2),className:"shoppingCart-form-paymentType-button ".concat(2===C&&"shoppingCart-form-paymentType-button--active"),children:[(0,a.jsx)("p",{className:"shoppingCart-form-paymentType-text",children:"Оплата при получении"}),(0,a.jsx)("div",{className:"shoppingCart-form-paymentType-checkbox",children:2===C&&(0,a.jsx)("img",{src:"".concat(n,"payment-choiced-icon.svg"),alt:"",className:"shoppingCart-form-paymentType-icon"})})]})]})]}),(0,a.jsxs)("div",{className:"shoppingCart-form-paymentInfo",children:[(0,a.jsx)("h2",{className:"shoppingCart-form-paymentInfo-title",children:"Форма оплаты"}),(0,a.jsxs)("button",{className:"shoppingCart-form-paymentInfo-sbpButton",children:[(0,a.jsxs)("div",{className:"shoppingCart-form-paymentInfo-sbpButton-top",children:[(0,a.jsx)("p",{className:"shoppingCart-form-paymentInfo-sbpButton-top-text",children:"Оплата по СБП"}),(0,a.jsx)("img",{src:"".concat(n,"sbp-icon.svg"),alt:""})]}),(0,a.jsx)("p",{className:"shoppingCart-form-paymentInfo-sbpButton-text",children:"После оформления заказа вы сможете получить реквизиты для оплаты по системе СБП"}),(0,a.jsx)("img",{src:"".concat(n,"payment-choiced-icon.svg"),alt:"",className:"shoppingCart-form-paymentInfo-sbpButton-icon"})]})]}),(0,a.jsxs)("div",{className:"shoppingCart-form-totalInfo",children:[(0,a.jsx)("h2",{className:"shoppingCart-form-totalInfo-title",children:"Промокод"}),(0,a.jsx)("input",{type:"text",placeholder:"Введите промокод",onChange:e=>eI(e.target.value),className:"shoppingCart-form-totalInfo-input"}),(0,a.jsxs)("div",{className:"shoppingCart-form-totalInfo-pricesContainer",children:[(0,a.jsxs)("div",{className:"shoppingCart-form-totalInfo-pricesContainer-item",children:[(0,a.jsx)("p",{className:"shoppingCart-form-totalInfo-pricesContainer-item-text",children:"Сумма заказа"}),(0,a.jsxs)("p",{className:"shoppingCart-form-totalInfo-pricesContainer-item-text",children:[eP()," ₽"]})]}),(0,a.jsxs)("div",{className:"shoppingCart-form-totalInfo-pricesContainer-item",children:[(0,a.jsx)("p",{className:"shoppingCart-form-totalInfo-pricesContainer-item-text",children:"Доставка"}),(0,a.jsxs)("p",{className:"shoppingCart-form-totalInfo-pricesContainer-item-text",children:[eH()," ₽"]})]}),eO()>0&&(0,a.jsxs)("div",{className:"shoppingCart-form-totalInfo-pricesContainer-item",children:[(0,a.jsx)("p",{className:"shoppingCart-form-totalInfo-pricesContainer-item-text",children:"Скидка"}),(0,a.jsxs)("p",{className:"shoppingCart-form-totalInfo-pricesContainer-item-text",children:["-",eO()," ₽"]})]})]}),(0,a.jsxs)("div",{className:"shoppingCart-form-totalInfo-summary",children:[(0,a.jsxs)("div",{className:"shoppingCart-form-totalInfo-summary-top",children:[(0,a.jsx)("p",{className:"shoppingCart-form-totalInfo-summary-top-text",children:"Итого"}),(0,a.jsxs)("p",{className:"shoppingCart-form-totalInfo-summary-top-text",children:[b&&2===C?eH():eP()-eO()+eH()," ","₽"]})]}),(0,a.jsxs)("p",{className:"shoppingCart-form-totalInfo-summary-count",children:[f.items.reduce((e,t)=>e+(t.quantity||1),0)," ",(()=>{let e=f.items.reduce((e,t)=>e+(t.quantity||1),0);return 0===e?"Товары в корзине отсутствуют":1===e?"товар":e>1&&e<5?"товара":"товаров"})()]})]})]}),(0,a.jsx)("button",{type:"button",onClick:eU,className:"shoppingCart-form-makeOrderButton click-effect-block \n                    ".concat(w?"button-behind-modal":"","\n                    ").concat(T?"ios-button":"","\n                    "),disabled:M,children:(0,a.jsx)("p",{className:"shoppingCart-form-makeOrderButton-text",children:M?"Оформление заказа...":"Оплатить заказ"})}),ep&&!k&&(0,a.jsx)("div",{className:"shoppingCart-form-error",children:ep})]})]})]})]})});var ee=r(9137),et=r.n(ee);r(7148),r(2022);let er=function(e){let{video:t}=e,r=(0,s.useRef)(null);return t.Video_URL?(0,a.jsxs)("div",{id:"Video-review",className:"video-review-block",children:[(0,a.jsx)("h3",{className:"video-review-title",children:"Видеообзор"}),(0,a.jsxs)("div",{className:"video-review-wrapper",onClick:()=>{console.log("CLICK");let e=r.current;e&&(e.paused?e.play().catch(e=>{console.error("Video play failed:",e)}):e.pause())},children:[(0,a.jsx)("div",{className:"video-review-helper-block"}),(0,a.jsx)("video",{ref:r,src:t.Video_URL,poster:t.Poster_URL||"",controls:!0,playsInline:!0,preload:t.Poster_URL?"none":"auto",className:"video-review-content"})]})]}):null},ea=(0,x.PA)(()=>{var e,t,r,i,c,d,p,m,h,x,v,j,_,b,y,k,w,A,P,D;let M=(0,o.g)();(0,l.useRouter)();let O=(0,o.Zp)(),F=(0,o.zy)(),[B,R]=(0,s.useState)(null);(0,s.useEffect)(()=>{M.productId&&(console.log(B),R(M.productId))},[M]);let W=(0,s.useRef)(null),H=(0,s.useRef)(null),[U,q]=(0,s.useState)({}),[V,J]=(0,s.useState)(!0),[z,G]=(0,s.useState)(!1),[Y,Q]=(0,s.useState)([]),[Z,K]=(0,s.useState)([]),[$,X]=(0,s.useState)({}),[ee,ea]=(0,s.useState)(null),[es,eo]=(0,s.useState)(null),[el,en]=(0,s.useState)(0),[ei,ec]=(0,s.useState)("Размер"),[ed,ep]=(0,s.useState)(!1),[em,eu]=(0,s.useState)(!1),[eg,eh]=(0,s.useState)(!1),[ex,ev]=(0,s.useState)(!1),[ef,ej]=(0,s.useState)(null),e_=[{title:"Наши гарантии на товар",image:"".concat(n,"warranty-icon.svg")},{title:"О нашем магазине",image:"".concat(n,"about-icon.svg")},{title:"Как можно вернуть товар?",image:"".concat(n,"refund-icon.svg")},{title:"Доставка и оплата товара",image:"".concat(n,"delivery-icon.svg")}];function eC(e,t,r){t?(r(!1),e.style.marginTop="0px",e.style.maxHeight="0px"):(r(!0),e.style.marginTop="15px",e.style.maxHeight="".concat(e.scrollHeight,"px"))}function eN(){W.current&&eC(W.current,ed,ep)}function eb(){H.current&&eC(H.current,em,eu)}function ey(e,t,r){eh(Z.some(a=>{let s=(null==a?void 0:a.productId)===e,o=!t||(null==a?void 0:a.id)===t,l=!r||(null==a?void 0:a.colorId)===r;return s&&o&&l}))}return((0,s.useEffect)(()=>{if(Object.keys($).length>0){let e=Object.values($).reduce((e,t)=>!t||t.colorCode?e:e+((null==t?void 0:t.price)||0),0);$.Color&&$.Color.discount&&(e=Math.max(0,e-$.Color.discount)),en(e)}else en(0)},[$]),(0,s.useEffect)(()=>{if(Object.entries(U).length){var e;let t={};if(eo(null),ea(null),(null==(e=U.parameters)?void 0:e.length)>0){let e=U.parameters.find(e=>e.chosen)||U.parameters[0];e&&(t[e.name]={id:e.Parameter_ID,index:0,title:e.parameter_string,price:e.price||0,old_price:e.old_price||null},ec(e.name),Q([{id:e.Parameter_ID,index:0,title:e.parameter_string,price:e.price||0,old_price:e.old_price||null}]))}Object.keys(t).length>0&&X(t)}},[U]),(0,s.useEffect)(()=>{let e=localStorage.getItem("addedSettingItems");if(e)try{K(JSON.parse(e))}catch(e){console.error("Ошибка при парсинге данных из localStorage:",e),K([])}},[]),(0,s.useEffect)(()=>{Z.length>0&&localStorage.setItem("addedSettingItems",JSON.stringify(Z))},[Z]),(0,s.useEffect)(()=>{if(Y.length>0&&(null==U?void 0:U.Product_ID)){let e=null==ee?void 0:ee.Color_ID;eh(Z.some(t=>{var r;let a=(null==t?void 0:t.id)===(null==(r=Y[0])?void 0:r.id)&&(null==t?void 0:t.productId)===U.Product_ID,s=!e||(null==t?void 0:t.colorId)===e;return a&&(!e||s)}))}},[Y,null==U?void 0:U.Product_ID,Z,ee]),(0,s.useEffect)(()=>{var e,t;let r=(null==U||null==(e=U.parameters)?void 0:e.length)>0,a=(null==U||null==(t=U.colors)?void 0:t.length)>0,s=!0;r&&(Object.keys($).some(e=>"Color"!==e)||(s=!1)),a&&!$.Color&&(s=!1),ev(s)},[U,$]),(0,s.useEffect)(()=>{J(!0);try{var e,t,r,a;console.log("ID продукта:",B);let s=null==(t=u.data)||null==(e=t.products)?void 0:e.find(e=>(null==e?void 0:e.Product_ID)===Number(B));console.log("Найденный продукт:",s),s?(G(!1),q(s),console.log("Детали продукта:",{images:s.images,parameters:s.parameters,hasColorsArray:!!(null==(r=s.colors)?void 0:r.length),parametersWithImages:(null==(a=s.parameters)?void 0:a.filter(e=>e.extra_field_image).length)||0}),J(!1)):G(!0)}catch(e){console.error("Ошибка при получении данных продукта:",e),G(!0)}},[B,u.data]),V)?(0,a.jsx)("main",{className:"main-container ".concat(g()?"main-container--ios":""),children:(0,a.jsx)("div",{className:"flex items-center justify-center w-full h-full min-h-[60vh]",children:(0,a.jsx)(E,{})})}):!z&&(null==U?void 0:U.Product_ID)?(0,a.jsxs)("main",{className:"jsx-72d4dd2679668bbf "+"main-container ".concat(g()?"main-container--ios":""),children:[(0,a.jsx)(et(),{id:"72d4dd2679668bbf",children:".swiper-pagination-bullet{width:8px!important;height:8px!important;opacity:.7!important;background:#999!important;margin:0 4px}.swiper-pagination-bullet-active{opacity:1!important;background:#333!important}.swiper-slide{display:-webkit-box!important;display:-webkit-flex!important;display:-moz-box!important;display:-ms-flexbox!important;display:flex!important;-webkit-box-pack:center!important;-webkit-justify-content:center!important;-moz-box-pack:center!important;-ms-flex-pack:center!important;justify-content:center!important;-webkit-box-align:center!important;-webkit-align-items:center!important;-moz-box-align:center!important;-ms-flex-align:center!important;align-items:center!important;width:100%!important;opacity:1!important}.swiper-slide-content{width:100%;height:100%;display:-webkit-box;display:-webkit-flex;display:-moz-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-webkit-align-items:center;-moz-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-moz-box-pack:center;-ms-flex-pack:center;justify-content:center}.product-image-item{max-width:100%;max-height:100%;-o-object-fit:contain;object-fit:contain}.swiper-pagination{bottom:10px!important;z-index:10!important}"}),(0,a.jsxs)("div",{className:"jsx-72d4dd2679668bbf product-image-container",children:[(null==(e=U.marks)?void 0:e.length)>0&&(null==(t=U.marks[0])?void 0:t.Mark_Name)?(0,a.jsx)("div",{className:"jsx-72d4dd2679668bbf "+"product-tag ".concat(S(U.marks[0].Mark_Name)),children:T(U.marks[0].Mark_Name)}):null,(0,a.jsx)("button",{onClick:()=>I.toggleFavorite(U.Product_ID),className:"jsx-72d4dd2679668bbf product-favorite",children:(0,a.jsx)("svg",{width:"25",height:"25",viewBox:"0 0 18 16",fill:I.favoritesIds.some(e=>e===U.Product_ID)?"#FE646F":"transparent",xmlns:"http://www.w3.org/2000/svg",className:"jsx-72d4dd2679668bbf cursor-pointer",children:(0,a.jsx)("path",{d:"M9.30663 14.7267L9.30662 14.7267L9.30029 14.7289C9.24983 14.7467 9.14099 14.7668 8.99996 14.7668C8.85893 14.7668 8.75009 14.7467 8.69963 14.7289L8.69964 14.7289L8.69329 14.7267C7.57825 14.346 5.71238 13.3333 4.13388 11.716C2.56322 10.1067 1.31663 7.94228 1.31663 5.24183C1.31663 3.02277 3.10364 1.2335 5.29996 1.2335C6.60123 1.2335 7.75317 1.86153 8.47812 2.8377C8.60075 3.00282 8.79429 3.10016 8.99996 3.10016C9.20563 3.10016 9.39917 3.00282 9.5218 2.8377C10.2464 1.86206 11.4064 1.2335 12.7 1.2335C14.8963 1.2335 16.6833 3.02277 16.6833 5.24183C16.6833 7.94228 15.4367 10.1067 13.866 11.716C12.2875 13.3333 10.4217 14.346 9.30663 14.7267Z",stroke:I.favoritesIds.some(e=>e===U.Product_ID)?"#FE646F":"#6C6C6C",strokeWidth:"1.3",strokeLinecap:"round",strokeLinejoin:"round",className:"jsx-72d4dd2679668bbf"})})}),es?(0,a.jsx)("div",{className:"jsx-72d4dd2679668bbf product-image",children:(0,a.jsx)("div",{className:"jsx-72d4dd2679668bbf swiper-slide-content",children:(0,a.jsx)("img",{src:es,alt:"Изображение товара ".concat(U.Product_Name||"Товар"),onError:e=>{console.error("Ошибка загрузки изображения цвета: ".concat(es)),e.currentTarget.src="/placeholder-image.jpg",eo(null)},className:"jsx-72d4dd2679668bbf product-image-item"})})}):(0,a.jsx)("div",{className:"jsx-72d4dd2679668bbf product-image",children:(()=>{try{let e=JSON.parse(JSON.stringify(U)),t=[...e.images||[]];if(console.log("Основные изображения:",t),e.parameters&&e.parameters.forEach(r=>{r.extra_field_image&&(console.log("Добавляем изображение из параметра: ".concat(r.parameter_string),r.extra_field_image),t.push({Image_ID:"param-".concat(r.Parameter_ID),Image_URL:r.extra_field_image,MainImage:!1,Product_ID:e.Product_ID,from_parameter:!0,parameter_name:r.parameter_string}))}),console.log("Все изображения для слайдера:",t),0===t.length)return(0,a.jsx)("div",{className:"jsx-72d4dd2679668bbf swiper-slide-content",children:(0,a.jsx)("img",{src:"/placeholder-image.jpg",alt:"Изображение товара отсутствует",className:"jsx-72d4dd2679668bbf product-image-item"})});if(1===t.length)return(0,a.jsx)("div",{className:"jsx-72d4dd2679668bbf swiper-slide-content",children:(0,a.jsx)("img",{src:t[0].Image_URL,alt:"Изображение товара ".concat(e.Product_Name||"Товар"),onError:e=>{console.error("Ошибка загрузки изображения: ".concat(t[0].Image_URL)),e.currentTarget.src="/placeholder-image.jpg"},className:"jsx-72d4dd2679668bbf product-image-item"})});return(0,a.jsx)(N.RC,{modules:[C.dK],spaceBetween:10,slidesPerView:1,pagination:{clickable:!0},className:"product-slider",onInit:e=>{console.log("Swiper инициализирован с",e.slides.length,"слайдами"),setTimeout(()=>e.update(),100)},children:t.map((t,r)=>(0,a.jsx)(N.qr,{children:(0,a.jsx)("div",{className:"jsx-72d4dd2679668bbf swiper-slide-content",children:(0,a.jsx)("img",{src:t.Image_URL,alt:"Изображение товара ".concat(e.Product_Name||"Товар"," ").concat(t.from_parameter?"(".concat(t.parameter_name,")"):""),onError:e=>{console.error("Ошибка загрузки изображения: ".concat(t.Image_URL)),e.currentTarget.src="/placeholder-image.jpg"},className:"jsx-72d4dd2679668bbf product-image-item"})})},"slide-".concat(r,"-").concat(t.Image_ID||Math.random())))})}catch(e){return console.error("Ошибка при рендеринге слайдера:",e),(0,a.jsx)("div",{className:"jsx-72d4dd2679668bbf swiper-slide-content",children:(0,a.jsx)("img",{src:"/placeholder-image.jpg",alt:"Ошибка загрузки изображений",className:"jsx-72d4dd2679668bbf product-image-item"})})}})()})]}),(0,a.jsxs)("div",{className:"jsx-72d4dd2679668bbf product-details",children:[(0,a.jsx)("h1",{className:"jsx-72d4dd2679668bbf product-title",children:U.Product_Name||"Неизвестный товар"}),(0,a.jsxs)("div",{className:"jsx-72d4dd2679668bbf price-container",children:[(0,a.jsxs)("p",{className:"jsx-72d4dd2679668bbf current-price",children:[el||0," ₽"]}),(null==ee?void 0:ee.discount)>0&&(0,a.jsxs)("p",{className:"jsx-72d4dd2679668bbf old-price",children:[el+ee.discount," ₽"]})]}),(null==(r=U.parameters)?void 0:r.length)>1&&(0,a.jsxs)("div",{className:"jsx-72d4dd2679668bbf parameters-section",children:[(0,a.jsx)("h3",{className:"jsx-72d4dd2679668bbf parameters-title",children:ei}),(0,a.jsx)("div",{className:"jsx-72d4dd2679668bbf parameters-content",children:(0,a.jsx)(L,{height:"38px",between:"5px",children:U.parameters.map(e=>{var t;let r=(null==(t=$[e.name])?void 0:t.id)===e.Parameter_ID;return(0,a.jsx)("div",{onClick:()=>(function(e,t){var r;if(!e)return;if("цвет"===t.toLowerCase()&&!(null==(r=U.colors)?void 0:r.length)){let t=U.parameters.find(t=>t.Parameter_ID===e.id);(null==t?void 0:t.extra_field_image)&&eo(t.extra_field_image)}let a={Color:$.Color};a[t]=e,ec(t),X(a),Q([e]),console.log("Выбран параметр: ".concat(t,", значение: ").concat(e.title)),ey(U.Product_ID,null==e?void 0:e.id,null==ee?void 0:ee.Color_ID)})({id:e.Parameter_ID,index:0,title:e.parameter_string,price:e.price||0,old_price:e.old_price},e.name),className:"jsx-72d4dd2679668bbf "+"parameters-item ".concat(r?"parameters-item--active":""),children:(0,a.jsx)("p",{className:"jsx-72d4dd2679668bbf parameters-text",children:e.parameter_string||"Без названия"})},"param-".concat(e.Parameter_ID||Math.random()))})})})]}),(null==(i=U.colors)?void 0:i.length)>0&&(0,a.jsxs)("div",{className:"jsx-72d4dd2679668bbf color-section",children:[(0,a.jsx)("h3",{className:"jsx-72d4dd2679668bbf parameters-title",children:"Цвет"}),(0,a.jsx)("div",{className:"jsx-72d4dd2679668bbf color-options",children:(0,a.jsx)(L,{height:"42px",between:"5px",children:U.colors.map(e=>(0,a.jsxs)("div",{onClick:()=>(function(e){if(!e)return;if(ee===e){ea(null),eo(null);return}ea(e),e.Color_image?eo(e.Color_image):eo(null);let t={...$};t.Color={id:e.Color_ID,title:e.Color_Name,colorCode:e.Color_Code,colorImage:e.Color_image,discount:e.discount||0},X(t),console.log("Выбран цвет: ".concat(e.Color_Name,", ID: ").concat(e.Color_ID,", изображение: ").concat(e.Color_image||"нет"));let r=Y[0];ey(U.Product_ID,null==r?void 0:r.id,e.Color_ID)})(e),className:"jsx-72d4dd2679668bbf "+"color-option ".concat((null==ee?void 0:ee.Color_ID)===e.Color_ID?"color-option--active":""),children:[(0,a.jsx)("div",{style:{backgroundColor:e.Color_Code||"#ccc"},className:"jsx-72d4dd2679668bbf color-circle"}),(0,a.jsx)("p",{className:"jsx-72d4dd2679668bbf color-name",children:e.Color_Name})]},"color-".concat(e.Color_ID||Math.random())))})})]}),(null==(c=U.reviews_video)?void 0:c.length)>0&&(null==(d=U.reviews_video[0])?void 0:d.Video_URL)&&(0,a.jsxs)("button",{onClick:function(){let e=document.getElementById("Video-review");e&&e.scrollIntoView({behavior:"smooth"})},className:"jsx-72d4dd2679668bbf video-button",children:[(0,a.jsxs)("div",{className:"jsx-72d4dd2679668bbf video-button-content",children:[(0,a.jsx)("img",{src:"".concat(n,"video-link-icon.svg"),alt:"Видео",onError:e=>{e.currentTarget.src="/placeholder-icon.svg"},className:"jsx-72d4dd2679668bbf"}),(0,a.jsx)("p",{className:"jsx-72d4dd2679668bbf video-button-text",children:"Смотреть видео-обзор"})]}),(0,a.jsx)("img",{src:"".concat(n,"dark-expand-icon.svg"),alt:"Смотерть",onError:e=>{e.currentTarget.src="/placeholder-icon.svg"},className:"jsx-72d4dd2679668bbf expand-icon"})]}),(null==(p=U.extras)?void 0:p.length)>0&&(null==(m=U.extras[0])?void 0:m.Characteristics)&&(0,a.jsxs)("div",{className:"jsx-72d4dd2679668bbf "+"description-block ".concat(ed?"description-block--open":""),children:[(0,a.jsxs)("div",{onClick:eN,className:"jsx-72d4dd2679668bbf description-header",children:[(0,a.jsx)("h3",{className:"jsx-72d4dd2679668bbf description-title",children:(null==(x=u.data)||null==(h=x.special_project_parameters)?void 0:h.product_page_accordeon_item_header_12_value)||"Описание"}),(0,a.jsx)("button",{onClick:eN,className:"jsx-72d4dd2679668bbf description-expand-button cursor-pointer",children:(0,a.jsx)("img",{src:"".concat(n,"dark-expand-icon.svg"),alt:"Развернуть",onError:e=>{e.currentTarget.src="/placeholder-icon.svg"},className:"jsx-72d4dd2679668bbf description-expand-icon"})})]}),(0,a.jsx)("p",{ref:W,className:"jsx-72d4dd2679668bbf description-text",children:U.extras[0].Characteristics})]}),(null==(v=U.extras)?void 0:v.length)>0&&(null==(j=U.extras[0])?void 0:j.Kit)&&(0,a.jsxs)("div",{className:"jsx-72d4dd2679668bbf "+"specs-block ".concat(em?"specs-block--open":""),children:[(0,a.jsxs)("div",{onClick:eb,className:"jsx-72d4dd2679668bbf specs-header",children:[(0,a.jsx)("h3",{className:"jsx-72d4dd2679668bbf specs-title",children:(null==(b=u.data)||null==(_=b.special_project_parameters)?void 0:_.product_page_accordeon_item_header_34_value)||"Характеристики"}),(0,a.jsx)("button",{onClick:eb,className:"jsx-72d4dd2679668bbf specs-expand-button cursor-pointer",children:(0,a.jsx)("img",{src:"".concat(n,"dark-expand-icon.svg"),alt:"Развернуть",onError:e=>{e.currentTarget.src="/placeholder-icon.svg"},className:"jsx-72d4dd2679668bbf specs-expand-icon"})})]}),(0,a.jsx)("p",{ref:H,className:"jsx-72d4dd2679668bbf specs-text",children:U.extras[0].Kit})]}),(null==(k=u.data)||null==(y=k.special_project_parameters_badges)?void 0:y.length)>0&&(0,a.jsx)("div",{className:"jsx-72d4dd2679668bbf info-cards ",children:(0,a.jsx)(L,{height:"100%",children:u.data.special_project_parameters_badges.slice(0,Math.min(4,u.data.special_project_parameters_badges.length)).map((e,t)=>{let r=t<e_.length?e_[t]:{title:"Информация",image:"".concat(n,"about-icon.svg")};return(0,a.jsxs)("div",{onClick:()=>(function(e){let t=window.Telegram.WebApp;t?t.openLink(e,{try_instant_view:!0}):window.open(e,"_blank")})(e.url||"#"),className:"jsx-72d4dd2679668bbf info-card click-effect-block",children:[(0,a.jsx)("p",{className:"jsx-72d4dd2679668bbf info-text",children:r.title}),(0,a.jsx)("img",{src:r.image,alt:r.title,onError:e=>{e.currentTarget.src="/placeholder-icon.svg"},className:"jsx-72d4dd2679668bbf info-icon"})]},e.id||t)})})}),(null==(w=U.reviews)?void 0:w.length)>0&&(0,a.jsxs)("div",{className:"jsx-72d4dd2679668bbf reviews-block",children:[(0,a.jsx)("h3",{className:"jsx-72d4dd2679668bbf reviews-title",children:"Отзывы"}),(0,a.jsx)(N.RC,{modules:[C.dK],spaceBetween:10,slidesPerView:1,pagination:{clickable:!0},className:"reviews-content",style:{width:"100%",height:"100%"},children:U.reviews.map(e=>(0,a.jsx)(N.qr,{children:(0,a.jsx)("div",{className:"jsx-72d4dd2679668bbf swiper-slide-content",children:(0,a.jsx)("img",{src:e.Photo_URL||"/placeholder-review.jpg",alt:"Отзыв пользователя",onError:e=>{e.currentTarget.src="/placeholder-review.jpg"},className:"jsx-72d4dd2679668bbf"})})},e.Photo_ID||Math.random()))}),(0,a.jsx)("button",{onClick:function(){var e,t;let r=null==(t=u.data)||null==(e=t.special_project_parameters)?void 0:e.reviews_link_value;r&&window.open(r,"_blank")},className:"jsx-72d4dd2679668bbf view-all-button",children:(0,a.jsx)("p",{className:"jsx-72d4dd2679668bbf view-all-text",children:"Смотреть все отзывы"})})]}),(null==(A=U.reviews_video)?void 0:A.length)>0&&(0,a.jsx)(er,{video:U.reviews_video[0]}),(0,a.jsx)("button",{onClick:function(){var e,t;if(!(null==U?void 0:U.Product_ID))return;if(eg){console.log("Переходим в корзину из:",F.pathname),window.location.hash="#/shoppingcart",setTimeout(()=>{O("/shoppingcart")},100);return}let r=(null==(e=U.parameters)?void 0:e.length)>0,a=(null==(t=U.colors)?void 0:t.length)>0,s=null;for(let e in $)if("Color"!==e&&$[e]){s=$[e];break}let o=$.Color;if(a&&!o){ej("Пожалуйста, выберите цвет товара"),setTimeout(()=>{ej(null)},3e3);return}if(r&&!s){ej("Пожалуйста, выберите параметр товара"),setTimeout(()=>{ej(null)},3e3);return}let l={paramId:null==s?void 0:s.id,paramTitle:null==s?void 0:s.title,colorId:null==o?void 0:o.id,colorName:null==o?void 0:o.title,colorCode:null==o?void 0:o.colorCode,colorImage:null==o?void 0:o.colorImage,discount:(null==o?void 0:o.discount)||0};f.addToCart(U.Product_ID,l),console.log("Товар добавлен в корзину:",l);let n={id:(null==s?void 0:s.id)||null,productId:U.Product_ID,title:(null==s?void 0:s.title)||null,colorId:null==o?void 0:o.id,colorName:null==o?void 0:o.title,colorImage:null==o?void 0:o.colorImage};K([...Z,n]),localStorage.setItem("addedSettingItems",JSON.stringify([...Z,n])),eh(!0),console.log("Сохранено в localStorage:",n)},disabled:!ex||(null==(P=U.colors)?void 0:P.length)>0&&!ee,className:"jsx-72d4dd2679668bbf "+"add-to-cart-button click-effect-block \n            ".concat(eg?"add-to-cart-button--added":"","\n            ").concat(!ex||(null==(D=U.colors)?void 0:D.length)>0&&!ee?"add-to-cart-button--disabled":"","\n            ").concat(g()?"add-to-cart-button--ios":""),children:(0,a.jsx)("p",{className:"jsx-72d4dd2679668bbf add-to-cart-text",children:eg?"В корзину":"Добавить в корзину"})})]}),ef&&(0,a.jsx)("div",{className:"jsx-72d4dd2679668bbf error-popup",children:(0,a.jsx)("p",{className:"jsx-72d4dd2679668bbf",children:ef})})]}):(0,a.jsx)("main",{className:"main-container ".concat(g()?"main-container--ios":""),children:(0,a.jsx)("div",{className:"flex items-center justify-center w-full h-full min-h-[60vh]",children:(0,a.jsx)("p",{className:"text-xl",children:"Произошла ошибка при загрузке товара или товар не найден."})})})});r(6803);let es=e=>{let{children:t}=e,r=(0,o.zy)();return(0,s.useEffect)(()=>{window.scrollTo({top:0,behavior:"smooth"})},[r.pathname]),t||null};function eo(){let[e,t]=(0,s.useState)(!1);return((0,s.useEffect)(()=>{t(!0)},[]),e)?(0,a.jsx)(o.I9,{children:(0,a.jsx)(es,{children:(0,a.jsx)(_,{children:(0,a.jsxs)(o.BV,{children:[(0,a.jsx)(o.qh,{path:"/",element:(0,a.jsx)(O,{})}),(0,a.jsx)(o.qh,{path:"/catalog",element:(0,a.jsx)(V,{})}),(0,a.jsx)(o.qh,{path:"/favorites",element:(0,a.jsx)(J,{})}),(0,a.jsx)(o.qh,{path:"/shoppingcart",element:(0,a.jsx)(X,{})}),(0,a.jsx)(o.qh,{path:"/product/:productId",element:(0,a.jsx)(ea,{})}),(0,a.jsx)(o.qh,{path:"*",element:(0,a.jsx)(o.C5,{to:"/",replace:!0})})]})})})}):(0,a.jsx)("main",{children:(0,a.jsx)(E,{})})}},1360:()=>{},1804:()=>{},2022:()=>{},2124:()=>{},4631:()=>{},6153:()=>{},6803:()=>{},6853:()=>{},7123:()=>{},7148:()=>{},7576:()=>{},7848:(e,t,r)=>{Promise.resolve().then(r.bind(r,601))},8274:()=>{},8358:()=>{},8548:()=>{},8720:()=>{},9894:()=>{}},e=>{var t=t=>e(e.s=t);e.O(0,[86,327,866,264,441,684,358],()=>t(7848)),_N_E=e.O()}]);